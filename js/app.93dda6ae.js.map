{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/App.vue?4199","webpack:////Users/anvaka/projects/isect/src/createEventQueue.js","webpack:////Users/anvaka/projects/isect/src/geom.js","webpack:////Users/anvaka/projects/isect/src/sweepStatus.js","webpack:////Users/anvaka/projects/isect/src/SweepEvent.js","webpack:////Users/anvaka/projects/isect/src/sweep.js","webpack:////Users/anvaka/projects/isect/src/intersectSegments.js","webpack:////Users/anvaka/projects/isect/src/brute.js","webpack:////Users/anvaka/projects/isect/src/bush.js","webpack:////Users/anvaka/projects/isect/src/index.js","webpack:///./src/App.vue?97f3","webpack:///./src/appStatus.js","webpack:///./src/generateRandomExample.js","webpack:///./src/bus.js","webpack:///src/App.vue","webpack:///./src/App.vue?1160","webpack:///./src/App.vue?bff9","webpack:///./src/BBox.js","webpack:///./src/scene.js","webpack:///./src/brownian.js","webpack:///./src/generators.js","webpack:///./src/main.js","webpack:////Users/anvaka/projects/w-gl/build/wgl.module.js"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","installedChunks","push","Object","prototype","hasOwnProperty","call","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","app","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_node_modules_css_loader_index_js_ref_6_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_6_oneOf_1_2_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_App_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0__","_node_modules_mini_css_extract_plugin_dist_loader_js_ref_6_oneOf_1_0_node_modules_css_loader_index_js_ref_6_oneOf_1_1_node_modules_vue_loader_lib_loaders_stylePostLoader_js_node_modules_postcss_loader_lib_index_js_ref_6_oneOf_1_2_node_modules_cache_loader_dist_cjs_js_ref_0_0_node_modules_vue_loader_lib_index_js_vue_loader_options_App_vue_vue_type_style_index_0_lang_css___WEBPACK_IMPORTED_MODULE_0___default","createEventQueue","byY","q","SplayTree","isEmpty","size","pop","find","insert","event","add","point","node","EPS","getIntersectionXPoint","segment","xPos","yPos","dy1","from","y","dy2","to","dy","Math","abs","x","xOffset","dx","angle","intersectSegments","a","b","aStart","bStart","p0_x","p0_y","p2_x","p2_y","s1_x","s1_y","s2_x","s2_y","div","samePoint","createSweepStatus","onError","lastPointY","prevY","lastPointX","prevX","useBelow","status","compareSegments","currentBoundary","beforeLeft","left","right","afterRight","currentLeftRight","insertSegments","deleteSegments","getLeftRightPoint","getBoundarySegments","findSegmentsWithPoint","checkDuplicate","printStatus","getLastPoint","ak","bk","res","aIsHorizontal","bIsHorizontal","pa","pb","segDist","upper","interior","leftMost","rightMost","uLength","cmp","startFrom","prev","next","lastLeft","current","_root","minX","Number","POSITIVE_INFINITY","onFound","collectAdjacentNodes","root","goOverPredecessors","goOverSuccessors","forEach","prefix","arguments","undefined","console","log","sweepLinePos","lower","prevCount","_size","removeSegment","remove","SweepEvent","classCallCheck","this","EMPTY","isect","segments","options","lastPoint","results","reportIntersection","defaultIntersectionReporter","defaultErrorReporter","eventQueue","sweepStatus","addSegment","run","step","eventPoint","handleEventPoint","addLowerOrInterior","sLeft","sRight","iLength","lLength","hasIntersection","hasPointIntersection","isReported","union","hasNoCrossing","leftRight","findNewEvent","boundarySegments","intersection","roundNearZero","temp","isPoint","prevFrom","e","errorMessage","Error","concat","brute","lines","asyncState","test","other","pt","bush","index","Flatbush","addToIndex","finish","checkIntersection","currentSegment","currentId","maxX","minY","maxY","ids","search","segmentIndex","otherSegment","line","__webpack_exports__","Appvue_type_template_id_d501ed2a_render","_vm","_h","$createElement","_c","_self","attrs","id","_m","showLoading","_e","staticClass","href","on","click","$event","preventDefault","generateNew","_v","_s","linesCount","found","elapsed","staticRenderFns","appStatus","error","showMetrics","createRandom","require","prng","params","algorithm","args","min","max","qs","round","gaussian","p0","v","random","p1","generateRandomExample","generatorIdx","generator","range","idx","keyName","Array","isArray","randomIndex","eventify","bus","Appvue_type_script_lang_js_","props","mounted","src_bus","fire","methods","newState","src_Appvue_type_script_lang_js_","component","componentNormalizer","__file","App","BBox","NEGATIVE_INFINITY","offset","xIn","yIn","rect","addPoint","top","bottom","otherBBox","createScene","wgl","canvas","isAsync","algorithmName","scene","setClearColor","bounds","pixelRatio","getPixelRatio","setViewBox","width","height","iSector","nodeCollection","linesEl","WireCollection","color","g","appendChild","nextFrame","totalElapsed","startTheDemoHandle","setTimeout","startTheDemo","dispose","runAsync","runSync","startTime","performance","now","intersections","updateSearchMetrics","drawIntersections","err","drawSweepStatus","start","end","requestAnimationFrame","frame","hasMore","formatWithDecimalSeparator","cancelAnimationFrame","clearTimeout","stepsPerFrame","removeChild","PointCollection","ui","setColor","keys","intersect","toString","replace","seed","Date","splash","minMax","alpha","PI","points","getArr","cos","sin","island","pointsCount","bands","sqrt","da","nextDouble","tMin","tMax","arr","variance","newArr","mid","interpolate","count","parallelSlanted","sparse","rows","columns","triangle","idxVar","idxToUse","drawTriangle","cp","rotate","middle","center","cube","forwardAngle","dAngle","addRect","grid","vertical","horizontal","drunkgrid","complete","angleStep","seen","Set","ex","ey","sKey","getKey","has","whitelistedAlgorithms","queryState","useSearch","onChange","updateScene","renderFirstTime","set","currentScene","sceneOptions","getSceneOptions","document","getElementById","appState","state","gen","getNumber","defaultValue","num","parseFloat","isFinite","Vue","config","productionTip","render","h","$mount","_addEventListener","_removeEventListener","support","wheel","addWheelListener","addWheelListener_1","removeWheelListener_1","removeWheelListener","elem","callback","useCapture","_addWheelListener","_removeWheelListener","eventName","originalEvent","target","srcElement","type","deltaMode","deltaX","deltaY","deltaZ","clientX","clientY","returnValue","stopPropagation","stopImmediatePropagation","wheelDelta","wheelDeltaX","detail","detectEventModel","addEventListener","createElement","onmousewheel","NEWTON_ITERATIONS","NEWTON_MIN_SLOPE","SUBDIVISION_PRECISION","SUBDIVISION_MAX_ITERATIONS","kSplineTableSize","kSampleStepSize","float32ArraySupported","Float32Array","A","aA1","aA2","B","C","calcBezier","aT","getSlope","binarySubdivide","aX","aA","aB","mX1","mX2","currentX","currentT","newtonRaphsonIterate","aGuessT","currentSlope","LinearEasing","src","mY1","mY2","sampleValues","getTForX","intervalStart","currentSample","lastSample","dist","guessForT","initialSlope","animations","ease","easeIn","easeOut","easeInOut","linear","amator","animate","makeAggregateRaf_1","makeAggregateRaf","sharedScheduler","source","diff","easing","warn","noop$1","done","scheduler","getScheduler","previousAnimationId","durationInMs","duration","durationInFrames","loop","cancel","setValues","canRaf","rafScheduler","timeoutScheduler","cb","frontBuffer","backBuffer","frameToken","clearAll","clear","renderNextFrame","renderFrame","kinetic_1","kinetic","getPoint","scroll","settings","_Users_anvaka_projects_isect_demo_interactive_node_modules_babel_runtime_helpers_builtin_es6_typeof__WEBPACK_IMPORTED_MODULE_9__","timestamp","ticker","vx","targetX","ax","vy","targetY","ay","raf","minVelocity","amplitude","timeConstant","stop","clearInterval","setInterval","track","currentPoint","dt","autoScroll","moving","exp","createEvent_1","createEvent","isIE","Event","evt","initCustomEvent","bubbles","textSelectionInterceptor","createTextSelectionInterceptor","dragObject","prevSelectStart","prevDragStart","capture","release","domObject","onselectstart","ondragstart","disabled","transform","Transform","scale","svgController","makeSvgController","svgElement","elementValid","SVGElement","owner","ownerSVGElement","setAttribute","api","getBBox","getScreenCTM","getOwner","applyTransform","initTransform","bbox","screenCTM","f","removeAttributeNS","domController","makeDomController","domElement","HTMLElement","parentElement","scrollTop","clientWidth","clientHeight","style","transformOrigin","preventTextSelection","defaultZoomSpeed","defaultDoubleTapZoomSpeed","doubleTapSpeedInMS","panzoom","createPanZoom","domController$$1","controller","storedCTMResult","isDirty","transform$$1","frameAnimation","realPinch","maxZoom","minZoom","boundsPadding","zoomDoubleClickSpeed","beforeWheel","noop","speed","zoomSpeed","validateBounds","autocenter","mouseX","mouseY","pinchZoomLength","smoothScroll","moveByAnimation","zoomToAnimation","multitouch","lastTouchEndTime","touchInProgress","panstartFired","rigidScroll","paused","listenForEvents","moveBy","internalMoveBy","moveTo","centerOn","zoomTo","publicZoomTo","zoomAbs","smoothZoom","getTransform","getTransformModel","showRectangle","pause","resume","isPaused","releaseEvents","transformToScreen","rectWidth","rectHeight","dw","dh","parentCTM","parentScaleX","parentScaleY","parentOffsetX","parentOffsetY","w","sceneBoundingBox","getBoundingBox","ownerRect","getBoundingClientRect","keepTransformInsideBounds","triggerEvent","makeDirty","boundingBox","adjusted","clientRect","getClientRect","sceneWidth","sceneHeight","leftTop","client","zoomByRatio","ratio","isNaN","newScale","transformAdjusted","zoomLevel","parent","cx","cy","container","smooth","lastX","lastY","cancelZoomAnimation","onMouseDown","onDoubleClick","onTouch","onKeyDown","onMouseWheel","removeEventListener","releaseDocumentMouse","releaseTouches","triggerPanEnd","z","keyCode","moveSpeedRatio","scaleMultiplier","getScaleMultiplier","beforeTouch","touches","handleSingleFingerTouch","getPinchZoomLength","startTouchListenerIfNeeded","touch","getOffsetXY","handleTouchMove","handleTouchEnd","triggerPanStart","t1","t2","currentPinchLength","delta","finger1","finger2","isLeftButton","button","onMouseMove","onMouseUp","offsetX","offsetY","fromValue","dispatchEvent","boundsType","validBounds","isNumber","autoRun","panzoomScript","scripts","getElementsByTagName","match","query","getAttribute","globalName","started","tryAttach","el","querySelector","collectOptions","script","attributes","attr","nameValue","getPanzoomAttributeNameValue","isPanZoomAttribute","substr","JSON","parse","ngraph_events$1","subject","validateSubject","eventsStorage","createEventsStorage","off","registeredEvents","ctx","handlers","wantToRemoveAll","deleteAllCallbacksForEvent","callbacks","fireArguments","callbackInfo","reservedWords","Transform$2","_array","prototypeAccessors","copyArray","multiply","newDx","newDy","copyTo","dst","getArray","defineProperties","Element","children","worldTransform","worldTransformNeedsUpdate","child","sendToBack","unshift","bindScene","traverse","enterCallback","exitCallback","this$1","childIdx","indexOf","updateWorldTransform","force","wasDirty","draw","gl","screen","maxSingleTouchTime","singleTapDistanceSquared","onClap$1","element","startPos","touchStartTime","invokeHandler","handleTouchStart","disposePrevHandler","pageX","pageY","changedTouches","makeScene$1","drawContext","devicePixelRatio","wglContextOptions","wglContext","getContext","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","enable","BLEND","clearColor","COLOR_BUFFER_BIT","sceneRoot","updateCanvasSize","disposeClick","getSceneCoordinate","getClientCoordinate","getRoot","setPixelRatio","wglController","wglPanZoom","panzoom$$1","listenToEvents","newPixelRatio","onTransform","onMouseClick","onResize","offsetWidth","offsetHeight","viewport","sceneX","sceneY","canvasX","canvasY","newT","customSizeCTM","glUtils","compile","link","getLocations","getAttributes","getUniforms","initBuffer","shaderSrc","shader","createShader","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","vertexShader","fragmentShader","program","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","uniforms","numberOfAttributes","ACTIVE_ATTRIBUTES","getActiveAttrib","getAttribLocation","numberOfUniforms","ACTIVE_UNIFORMS","getActiveUniform","getUniformLocation","elementsPerVertex","attribute","buffer","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","vertexAttribPointer","FLOAT","enableVertexAttribArray","shaderGraph","getVSCode","nodes","code","globals","mainBody","join","panzoomVS","pointVS","vertexShaderSrc","fragmentShaderSrc","vertexProgramCache","Map","makePointsProgram$1","vertexProgram","VERTEX_SHADER","FRAGMENT_SHADER","locations","byteLength","DYNAMIC_DRAW","pointTexture","createCircleTexture","updateData","newData","deleteProgram","deleteTexture","delete","useProgram","bpe","BYTES_PER_ELEMENT","uniformMatrix4fv","uTransform","uniform2f","uScreenSize","bindTexture","TEXTURE_2D","aPosition","aPointSize","aColor","drawArrays","POINTS","createTexture","image","circle","texImage2D","RGBA","UNSIGNED_BYTE","texParameteri","TEXTURE_MAG_FILTER","LINEAR","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","CLAMP_TO_EDGE","TEXTURE_WRAP_T","generateMipmap","Uint8Array","row","col","rgbaCoord","distToCenter","blur","sample","depth","avg","Color","PointAccessor","prototypeAccessors$1","update","defaults","ITEMS_PER_POINT","Element$$1","capacity","pointsAccessor","pointsBuffer","_program","__proto__","constructor","_extendArray","internalNodeId","pointAccessor","Point","BaseLineCollection","itemsPerLine","_makeProgram","_addInternal","newCapacity","extendedArray","lineVSSrc","lineFSSrc","lineProgramCache","makeLineProgram","drawTriangles","lineProgram","lineVSShader","lineFSShader","lineBuffer","drawType","TRIANGLES","LINES","bufferSubData","deleteBuffer","uniform4f","uColor","LineAccessor","setWidth","norm","u","uw","vw","x0","y0","x1","y1","x2","y2","x3","y3","LineCollection","BaseLineCollection$$1","lineUI","WireAccessor","isWebGLEnabled$1","WebGLRenderingContext"],"mappings":"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","file":"js/app.93dda6ae.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","import mod from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/lib/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../node_modules/css-loader/index.js??ref--6-oneOf-1-1!../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../node_modules/postcss-loader/lib/index.js??ref--6-oneOf-1-2!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=style&index=0&lang=css&\"","import SplayTree from 'splaytree';\n\nexport default function createEventQueue(byY) {\n  const q = new SplayTree(byY);\n\n  return {\n    isEmpty: isEmpty,\n    size: size,\n    pop: pop,\n    find: find,\n    insert: insert\n  }\n\n  function find(p) {\n    return q.find(p);\n  }\n\n  function size() {\n    return q.size;\n  }\n\n  function isEmpty() {\n    return q.isEmpty();\n  }\n\n  function insert(event) {\n    // debugger;\n    q.add(event.point, event);\n  }\n\n  function pop() {\n    var node = q.pop();\n    return node && node.data;\n  }\n}\n","/**\n * Just a collection of geometry related utilities\n */\n\n// This is used for precision checking (e.g. two numbers are equal\n// if their difference is smaller than this number). The value is \n// chosen empirically. We still may run into precision related issues.\n// TODO: we should allow consumers to configure this.\nexport const EPS = 1e-9;//10;\n\nexport function getIntersectionXPoint(segment, xPos, yPos) {\n  var dy1 = segment.from.y - yPos;\n  var dy2 = yPos - segment.to.y;\n  var dy = segment.to.y - segment.from.y;\n  if (Math.abs(dy1) < EPS) {\n    // The segment starts on the sweep line\n    if (Math.abs(dy) < EPS) {\n      // the segment is horizontal. Intersection is at the point\n      if (xPos <= segment.from.x) return segment.from.x;\n      if (xPos > segment.to.x) return segment.to.x;\n      return xPos;\n    }\n    return segment.from.x;\n  }\n  \n  var dx = (segment.to.x - segment.from.x); \n  var xOffset; \n  if (dy1 >= dy2) {\n    xOffset = dy1 * (dx / dy); \n    return (segment.from.x - xOffset);\n  } \n  xOffset = dy2 * (dx / dy);\n  return (segment.to.x + xOffset);\n}\n\nexport function angle(dx, dy) {\n  // https://stackoverflow.com/questions/16542042/fastest-way-to-sort-vectors-by-angle-without-actually-computing-that-angle\n  var p = dx/(Math.abs(dx) + Math.abs(dy)) // -1 .. 1 increasing with x\n\n  if (dy < 0) return p - 1;  // -2 .. 0 increasing with x\n  return 1 - p               //  0 .. 2 decreasing with x\n}\n\nexport function intersectSegments(a, b) {\n  //  https://stackoverflow.com/a/1968345/125351\n  var aStart = a.from, bStart = b.from;\n  var p0_x = aStart.x, p0_y = aStart.y,\n      p2_x = bStart.x, p2_y = bStart.y;\n\n  var s1_x = a.dx, s1_y = a.dy, s2_x = b.dx, s2_y = b.dy;\n  var div = s1_x * s2_y - s2_x * s1_y;\n\n  var s = (s1_y * (p0_x - p2_x) - s1_x * (p0_y - p2_y)) / div;\n  if (s < 0 || s > 1) return;\n\n  var t = (s2_x * (p2_y - p0_y) + s2_y * (p0_x - p2_x)) / div;\n\n  if (t >= 0 && t <= 1) {\n    return {\n      x: p0_x - (t * s1_x),\n      y: p0_y - (t * s1_y)\n    }\n  }\n}\n\nexport function same(x0, x1, y0, y1) {\n  return Math.abs(x0 - x1) < EPS && Math.abs(y0 - y1) < EPS;\n}\n\nexport function samePoint(a, b) {\n  return Math.abs(a.x - b.x) < EPS && Math.abs(a.y - b.y) < EPS;\n}\n","import SplayTree from 'splaytree';\nimport {samePoint, getIntersectionXPoint} from './geom'\n\n/**\n * Creates a new sweep status data structure.\n */\nexport default function createSweepStatus(onError, EPS) {\n  var lastPointY, prevY;\n  var lastPointX, prevX;\n  var useBelow = false;\n  var status = new SplayTree(compareSegments);\n\n  // To save on GC we return mutable object.\n  var currentBoundary = {\n    beforeLeft: null,\n    left: null,\n    right: null,\n    afterRight: null,\n  }\n\n  var currentLeftRight = {left: null, right: null};\n\n  return {\n    /**\n     * Add new segments into the status tree.\n     */\n    insertSegments,\n\n    /**\n     * Remove segments from the status tree.\n     */\n    deleteSegments,\n\n    /**\n     * Returns segments that are to the left and right from a given point.\n     */\n    getLeftRightPoint,\n\n    /**\n     * For a given collections of segments finds the most left and the most right\n     * segments. Also returns segments immediately before left, and after right segments.\n     */\n    getBoundarySegments,\n\n    findSegmentsWithPoint,\n\n    /**\n     * Current binary search tree with segments\n     */\n    status,\n\n    /**\n     * Introspection method that verifies if there are duplicates in the segment tree.\n     * If there are - `onError()` is called.\n     */\n    checkDuplicate,\n\n    /**\n     * Prints current segments in order of their intersection with sweep line. Introspection method.\n     */\n    printStatus,\n\n    /**\n     * Returns current position of the sweep line.\n     */\n    getLastPoint() {\n      return {x: lastPointX, y: lastPointY};\n    }\n  }\n\n  function compareSegments(a, b) {\n    if (a === b) return 0;\n\n    var ak = getIntersectionXPoint(a, lastPointX, lastPointY);\n    var bk = getIntersectionXPoint(b, lastPointX, lastPointY);\n\n    var res = ak - bk;\n    if (Math.abs(res) >= EPS) {\n      // We are okay fine. Intersection distance between two segments\n      // is good to give conclusive answer\n      return res;\n    }\n\n    var aIsHorizontal = Math.abs(a.dy) < EPS;\n    var bIsHorizontal = Math.abs(b.dy) < EPS;\n    if (aIsHorizontal && bIsHorizontal) {\n      return b.to.x - a.to.x;\n    }\n    // TODO: What if both a and b is horizontal?\n    // move horizontal to end\n    if (aIsHorizontal) { \n      return useBelow ? -1 : 1;\n    }\n\n    if (bIsHorizontal) {\n      if (useBelow) {\n        return (b.from.x >= lastPointX) ? -1 : 1\n      }\n      return -1;\n      // return useBelow ? 1 : -1;\n    }\n    var pa = a.angle;\n    var pb = b.angle;\n    if (Math.abs(pa - pb) >= EPS) {\n      return useBelow ? pa - pb : pb - pa;\n    }\n\n    var segDist = a.from.y - b.from.y;\n    if (Math.abs(segDist) >= EPS) {\n      return -segDist;\n    }\n    segDist = a.to.y - b.to.y;\n    if (Math.abs(segDist) >= EPS) {\n      // TODO: Is this accurate?\n      return -segDist;\n    }\n\n    return 0;\n    // Could also use:\n    // var aAngle = Math.atan2(a.from.y - a.to.y, a.from.x - a.to.x);\n    // var bAngle = Math.atan2(b.from.y - b.to.y, b.from.x - b.to.x);\n    // return useBelow ? bAngle - aAngle : aAngle - bAngle;\n  }\n\n  function getBoundarySegments(upper, interior) {\n    var leftMost, rightMost, i;\n    var uLength = upper.length;\n\n    if (uLength > 0) {\n      leftMost = rightMost = upper[0];\n    } else {\n      leftMost = rightMost = interior[0];\n    }\n\n    for (i = 1; i < uLength; ++i) {\n      var s = upper[i];\n      var cmp = compareSegments(leftMost, s);\n      if (cmp > 0) leftMost = s;\n\n      cmp = compareSegments(rightMost, s);\n      if (cmp < 0) rightMost = s;\n    }\n\n    var startFrom = uLength > 0 ? 0 : 1;\n    for (i = startFrom; i < interior.length; ++i) {\n      s = interior[i];\n      cmp = compareSegments(leftMost, s);\n      if (cmp > 0) leftMost = s;\n\n      cmp = compareSegments(rightMost, s);\n      if (cmp < 0) rightMost = s;\n    }\n\n    // at this point we have our left/right segments in the status.\n    // Let's find their prev/next elements and report them back:\n    var left = status.find(leftMost);\n    if (!left) {\n      onError('Left is missing. Precision error?');\n    }\n\n    var right = status.find(rightMost);\n    if (!right) {\n      onError('Right is missing. Precision error?');\n    }\n\n    var beforeLeft = left && status.prev(left);\n    var afterRight = right && status.next(right);\n\n    while (afterRight && right.key.dy === 0 && afterRight.key.dy === 0) {\n      // horizontal segments are special :(\n      afterRight = status.next(afterRight);\n    }\n\n    currentBoundary.beforeLeft = beforeLeft && beforeLeft.key;\n    currentBoundary.left = left && left.key;\n    currentBoundary.right = right && right.key;\n    currentBoundary.afterRight = afterRight && afterRight.key;\n\n    return currentBoundary;\n  }\n\n  function getLeftRightPoint(p) {\n    // We are trying to find left and right segments that are nearest to the\n    // point p. For this we traverse the binary search tree, and remember\n    // node with the shortest distance to p.\n    var lastLeft;\n    var current = status._root;\n    var minX = Number.POSITIVE_INFINITY;\n\n    var useNext = false;\n    while (current) {\n      var x = getIntersectionXPoint(current.key, p.x, p.y);\n      var dx = p.x - x;\n      if (dx >= 0) {\n        if (dx < minX) {\n          minX = dx;\n          lastLeft = current;\n          current = current.left;\n          useNext = false;\n        } else {\n          break;\n        }\n      } else {\n        if (-dx < minX) {\n          useNext = true;\n          minX = -dx;\n          lastLeft = current;\n          current = current.right;\n        } else {\n          break;\n        }\n      }\n    }\n    if (useNext) {\n      // I'm not sure why I did this. I don't this this is right now.\n      // lastLeft = status.next(lastLeft);\n    }\n\n    currentLeftRight.left = lastLeft && lastLeft.key\n    var next = lastLeft && status.next(lastLeft);\n    currentLeftRight.right = next && next.key\n    return currentLeftRight;\n\n    // Conceptually, the code above should be equivalent to the code below;\n    // The code below is easier to understand, but intuitively, the code above\n    // should have better performance (as we do not traverse the entire status\n    // tree)\n\n    // var right, left,  x;\n    // var all = status.keys()\n    // for (var i = 0; i < all.length; ++i) {\n    //   var segment = all[i];\n    //   x = getIntersectionXPoint(segment, p.x, p.y);\n    //   if (x > p.x && !right) {\n    //     right = segment;\n    //     break;\n    //   } else if (x < p.x) {\n    //     left = segment;\n    //   }\n    // }\n\n    // currentLeftRight.left = left;\n    // currentLeftRight.right = right;\n\n    // return currentLeftRight;\n  }\n\n  function findSegmentsWithPoint(p, onFound) {\n    // Option 1.\n    // var arrResults = [];\n    // status.forEach(current => {\n    //   var x = getIntersectionXPoint(current.key, p.x, p.y);\n    //   var dx = p.x - x;\n    //   if (Math.abs(dx) < EPS) {\n    //     onFound(current.key);\n    //    // arrResults.push(current.key)\n    //   }\n    // });\n    // return arrResults;\n\n    // Option 2.\n\n    // let current = status._root;\n    // const Q = [];  /* Initialize stack s */\n    // let done = false;\n    // var res = [];\n    // var breakEarly = false;\n\n    // while (!done) {\n    //   if (current !==  null) {\n    //     Q.push(current);\n    //     current = current.left;\n    //   } else {\n    //     if (Q.length !== 0) {\n    //       current = Q.pop();\n\n    //       var x = getIntersectionXPoint(current.key, p.x, p.y);\n    //       var dx = p.x - x;\n    //       if (Math.abs(dx) < EPS) {\n    //         res.push(current.key)\n    //         breakEarly = true;\n    //       } else if (breakEarly) {\n    //         done = true;\n    //       }\n\n    //       current = current.right;\n    //     } else done = true;\n    //   }\n    // }\n\n    // return res;\n\n    // option 3.\n    var current = status._root;\n\n    while (current) {\n      var x = getIntersectionXPoint(current.key, p.x, p.y);\n      var dx = p.x - x;\n      if (Math.abs(dx) < EPS) {\n        collectAdjacentNodes(current, p, onFound);\n        break;\n      } else if (dx < 0) {\n        current = current.left;\n      } else {\n        current = current.right;\n      }\n    }\n  }\n\n  function collectAdjacentNodes(root, p, onFound) {\n    onFound(root.key);\n    goOverPredecessors(root.left, p, onFound);\n    goOverSuccessors(root.right, p, onFound);\n  }\n\n  function goOverPredecessors(root, p, res) {\n    if (!root) return;\n    var x = getIntersectionXPoint(root.key, p.x, p.y);\n    var dx = p.x - x;\n    if (Math.abs(dx) < EPS) {\n      collectAdjacentNodes(root, p, res);\n    } else {\n      goOverPredecessors(root.right, p, res);\n    }\n  }\n\n  function goOverSuccessors(root, p, res) {\n    if (!root) return;\n    var x = getIntersectionXPoint(root.key, p.x, p.y);\n    var dx = p.x - x;\n    if (Math.abs(dx) < EPS) {\n      collectAdjacentNodes(root, p, res);\n    } else {\n      goOverSuccessors(root.left, p, res);\n    }\n  }\n\n  function checkDuplicate() {\n    var prev;\n    status.forEach(node => {\n      var current = node.key;\n\n      if (prev) {\n        if (samePoint(prev.from, current.from) && samePoint(prev.to, current.to)) {\n          // Likely you have received error before during segment removal.\n          onError('Duplicate key in the status! This may be caused by Floating Point rounding error')\n        }\n      }\n      prev = current;\n    });\n  }\n\n  function printStatus(prefix = '') {\n    // eslint-disable-next-line\n    console.log(prefix, 'status line: ', lastPointX, lastPointY);\n    status.forEach(node => {\n      var x = getIntersectionXPoint(node.key, lastPointX, lastPointY);\n      // eslint-disable-next-line\n      console.log(x + ' ' + node.key.name);\n    })\n  }\n\n  function insertSegments(interior, upper, sweepLinePos) {\n    lastPointY = sweepLinePos.y;\n    lastPointX = sweepLinePos.x;\n    var key;\n\n    for (var i = 0; i < interior.length; ++i) {\n      key = interior[i];\n      status.add(key);\n    }\n    for (i = 0; i < upper.length; ++i) {\n      key = upper[i]\n      status.add(key);\n    }\n  }\n\n  function deleteSegments(lower, interior, sweepLinePos) {\n    // I spent most of the time debugging this method. Depending on the\n    // algorithm state we can run into situation when dynamic keys of the\n    // `status` tree predict wrong branch, and thus we are not able to find\n    // the segment that needs to be deleted. If that happens I'm trying to\n    // use previous point and repeat the process. This may result in \n    // incorrect state. In that case I report an error. \n    var i;\n    var prevCount = status._size;\n    prevX = lastPointX;\n    prevY = lastPointY;\n    lastPointY = sweepLinePos.y;\n    lastPointX = sweepLinePos.x;\n\n    useBelow = true;\n    for(i = 0; i < lower.length; ++i) {\n      removeSegment(lower[i], sweepLinePos)\n    }\n    for(i = 0; i < interior.length; ++i) {\n      removeSegment(interior[i], sweepLinePos)\n    }\n    useBelow = false;\n\n    if (status._size !== prevCount - interior.length - lower.length) {\n      // This can happen when rounding error occurs. You can try scaling your input\n      onError('Segments were not removed from a tree properly. Precision error?');\n    }\n  }\n\n  function removeSegment(key, sweepLinePos) {\n    if (status.find(key)) {\n      status.remove(key);\n    } else {\n      lastPointX = prevX;\n      lastPointY = prevY;\n      if (status.find(key)) {\n        status.remove(key);\n      } else {\n        // They will get an error :(\n      }\n      lastPointY = sweepLinePos.y;\n      lastPointX = sweepLinePos.x;\n    }\n  }\n}","/**\n * Represents a single event in the sweep-line algorithm\n */\nexport default class SweepEvent {\n  /**\n   * Creates new sweep event of a given kind.\n   */\n  constructor(point, segment) {\n    this.point = point;\n    if (segment) this.from = [segment];\n  }\n}\n","import createEventQueue from './createEventQueue';\nimport createSweepStatus from './sweepStatus';\nimport SweepEvent from './SweepEvent';\n\nimport {intersectSegments, EPS, angle, samePoint} from './geom';\n\n/**\n * A point on a line\n * \n * @typedef {Object} Point\n * @property {number} x coordinate\n * @property {number} y coordinate\n */\n\n\n/**\n * @typedef {Object} Segment \n * @property {Point} from start of the segment\n * @property {Point} to end of the segment\n */\n\n/**\n * @typedef {function(point : Point, interior : Segment[], lower : Segment[], upper : Segment[])} ReportIntersectionCallback\n */\n\n/**\n * @typedef {Object} ISectOptions \n * @property {ReportIntersectionCallback} onFound \n */\n\n /**\n  * @typedef {Object} ISectResult\n  */\n\n// We use EMPTY array to avoid pressure on garbage collector. Need to be\n// very cautious to not mutate this array.\nvar EMPTY = [];\n\n/**\n * Finds all intersections among given segments.\n * \n * The algorithm follows \"Computation Geometry, Algorithms and Applications\" book\n * by Mark de Berg, Otfried Cheong, Marc van Kreveld, and Mark Overmars.\n * \n * Line is swept top-down\n * \n * @param {Segment[]} segments\n * @param {ISectOptions=} options\n * @returns {ISectResult}\n */\nexport default function isect(segments, options) {\n  var results = [];\n  var reportIntersection = (options && options.onFound) || defaultIntersectionReporter;\n\n  var onError = (options && options.onError) || defaultErrorReporter;\n\n  var eventQueue = createEventQueue(byY);\n  var sweepStatus = createSweepStatus(onError, EPS);\n  var lower, interior, lastPoint;\n\n  segments.forEach(addSegment);\n\n  return {\n    /**\n     * Find all intersections synchronously.\n     * \n     * @returns array of found intersections.\n     */\n    run,\n\n    /**\n     * Performs a single step in the sweep line algorithm\n     * \n     * @returns true if there was something to process; False if no more work to do\n     */\n    step,\n\n    // Methods below are low level API for fine-grained control.\n    // Don't use it unless you understand this code thoroughly\n\n    /**\n     * Add segment into the \n     */\n    addSegment,\n\n    /**\n     * Direct access to event queue. Queue contains segment endpoints and\n     * pending detected intersections.\n     */\n    eventQueue, \n\n    /**\n     * Direct access to sweep line status. \"Status\" holds information about\n     * all intersected segments.\n     */\n    sweepStatus,\n\n    /**\n     * Access to results array. Works only when you use default onFound() handler\n     */\n    results\n  }\n\n  function run() {\n    while (!eventQueue.isEmpty()) {\n      var eventPoint = eventQueue.pop();\n      if (handleEventPoint(eventPoint)) {\n        // they decided to stop.\n        return;\n      };\n    }\n\n    return results;\n  }\n\n  function step() {\n    if (!eventQueue.isEmpty()) {\n      var eventPoint = eventQueue.pop();\n      handleEventPoint(eventPoint);\n      // Note: we don't check results of `handleEventPoint()`\n      // assumption is that client controls `step()` and thus they \n      // know better if they want to stop.\n      return true;\n    }\n    return false;\n  }\n\n  function handleEventPoint(p) {\n    lastPoint = p.point;\n    var upper = p.from || EMPTY;\n\n    lower = interior = undefined;\n    // TODO: move lower/interior into sweep status method?\n\n    sweepStatus.findSegmentsWithPoint(lastPoint, addLowerOrInterior);\n    // if (segmentsWithPoint) {\n    //   segmentsWithPoint.forEach()\n    // } \n\n    if (!lower) lower = EMPTY;\n    if (!interior) interior = EMPTY;\n\n    var uLength = upper.length;\n    var iLength = interior.length;\n    var lLength = lower.length;\n    var hasIntersection = uLength + iLength + lLength > 1;\n    var hasPointIntersection = !hasIntersection && (uLength === 0 && lLength === 0 && iLength > 0);\n\n    if (hasIntersection || hasPointIntersection) {\n      p.isReported = true;\n      if (reportIntersection(lastPoint, union(interior, union(lower, upper)))) {\n        return true;\n      }\n    }\n\n    sweepStatus.deleteSegments(lower, interior, lastPoint);\n    sweepStatus.insertSegments(interior, upper, lastPoint);\n\n    var sLeft, sRight;\n\n    var hasNoCrossing = (uLength + iLength === 0);\n\n    if (hasNoCrossing) {\n      var leftRight = sweepStatus.getLeftRightPoint(lastPoint);\n      sLeft = leftRight.left;\n      if (!sLeft) return;\n\n      sRight = leftRight.right;\n      if (!sRight) return;\n\n      findNewEvent(sLeft, sRight, p);\n    } else {\n      var boundarySegments = sweepStatus.getBoundarySegments(upper, interior);\n\n      findNewEvent(boundarySegments.beforeLeft, boundarySegments.left, p);\n      findNewEvent(boundarySegments.right, boundarySegments.afterRight, p);\n    }\n\n    return false;\n  }\n\n  function addLowerOrInterior(s) {\n    if (samePoint(s.to, lastPoint)) {\n      if (!lower) lower = [s];\n      else lower.push(s);\n    } else if (!samePoint(s.from, lastPoint)) {\n      if (!interior) interior = [s];\n      else interior.push(s);\n    }\n  }\n\n  function findNewEvent(left, right, p) {\n    if (!left || !right) return;\n\n    var intersection = intersectSegments(left, right);\n    if (!intersection) {\n        return;\n    }\n\n    var dy = p.point.y - intersection.y\n    // TODO: should I add dy to intersection.y?\n    if (dy < -EPS) {\n      // this means intersection happened after the sweep line. \n      // We already processed it.\n      return;\n    }\n    if (Math.abs(dy) < EPS && intersection.x <= p.point.x) {\n      return;\n    }\n\n    // Need to adjust floating point for this special case,\n    // since otherwise it gives rounding errors:\n    roundNearZero(intersection);\n\n    var current = eventQueue.find(intersection);\n\n    if (current && current.isReported) {\n      // We already reported this event. No need to add it one more time\n      // TODO: Is this case even possible?\n      onError('We already reported this event.');\n      return;\n    }\n\n    if (!current) {\n      var event = new SweepEvent(intersection)\n      eventQueue.insert(event);\n    }\n  }\n\n  function defaultIntersectionReporter(p, segments) {\n    results.push({\n      point: p, \n      segments: segments\n    });\n  }\n\n  function addSegment(segment) {\n    var from = segment.from;\n    var to = segment.to;\n\n    // Small numbers give more precision errors. Rounding them to 0.\n    roundNearZero(from);\n    roundNearZero(to);\n\n    var dy = from.y - to.y;\n\n    // Note: dy is much smaller then EPS on purpose. I found that higher\n    // precision here does less good - getting way more rounding errors.\n    if (Math.abs(dy) < 1e-5) {\n      from.y = to.y;\n      segment.dy = 0;\n    }\n    if ((from.y < to.y) || (\n        (from.y === to.y) && (from.x > to.x))\n      ) {\n      var temp = from;\n      from = segment.from = to; \n      to = segment.to = temp;\n    }\n\n    // We pre-compute some immutable properties of the segment\n    // They are used quite often in the tree traversal, and pre-computation\n    // gives significant boost:\n    segment.dy = from.y - to.y;\n    segment.dx = from.x - to.x;\n    segment.angle = angle(segment.dy, segment.dx);\n\n    var isPoint = segment.dy === segment.dx && segment.dy === 0;\n    var prev = eventQueue.find(from)\n    if (prev && !isPoint) {\n      // this detects identical segments early. Without this check\n      // the algorithm would break since sweep line has no means to\n      // detect identical segments.\n      var prevFrom = prev.data.from;\n      if (prevFrom) {\n        for (var i = 0; i < prevFrom.length; ++i) {\n          var s = prevFrom[i];\n          if (samePoint(s.to, to)) {\n            reportIntersection(s.from, [s.from, s.to]);\n            reportIntersection(s.to, [s.from, s.to]);\n            return;\n          }\n        }\n      }\n    }\n\n    if (!isPoint) {\n      if (prev) {\n        if (prev.data.from) prev.data.from.push(segment);\n        else prev.data.from = [segment];\n      } else {\n        var e = new SweepEvent(from, segment)\n        eventQueue.insert(e);\n      }\n      var event = new SweepEvent(to)\n      eventQueue.insert(event)\n    } else {\n      var event = new SweepEvent(to)\n      eventQueue.insert(event)\n    }\n  } \n}\n\nfunction roundNearZero(point) {\n  if (Math.abs(point.x) < EPS) point.x = 0;\n  if (Math.abs(point.y) < EPS) point.y = 0;\n}\n\nfunction defaultErrorReporter(errorMessage) {\n  throw new Error(errorMessage);\n}\n\nfunction union(a, b) {\n  if (!a) return b;\n  if (!b) return a;\n\n  return a.concat(b);\n}\n\nfunction byY(a, b) {\n  // decreasing Y \n  var res = b.y - a.y;\n  // TODO: This might mess up the status tree.\n  if (Math.abs(res) < EPS) {\n    // increasing x.\n    res = a.x - b.x;\n    if (Math.abs(res) < EPS) res = 0;\n  }\n\n  return res;\n}","export default function intersectSegments(a, b) {\n  // Note: this is almost the same as geom.intersectSegments()\n  // The main difference is that we don't have a pre-computed\n  // value for dx/dy on the segments.\n  //  https://stackoverflow.com/a/1968345/125351\n  var aStart = a.from, bStart = b.from;\n  var p0_x = aStart.x, p0_y = aStart.y,\n      p2_x = bStart.x, p2_y = bStart.y;\n\n  var s1_x = a.from.x - a.to.x, s1_y = a.from.y - a.to.y, s2_x = b.from.x - b.to.x, s2_y = b.from.y - b.to.y;\n  var div = s1_x * s2_y - s2_x * s1_y;\n\n  var s = (s1_y * (p0_x - p2_x) - s1_x * (p0_y - p2_y)) / div;\n  if (s < 0 || s > 1) return;\n\n  var t = (s2_x * (p2_y - p0_y) + s2_y * (p0_x - p2_x)) / div;\n\n  if (t >= 0 && t <= 1) {\n    return {\n      x: p0_x - (t * s1_x),\n      y: p0_y - (t * s1_y)\n    }\n  }\n}","import intersectSegments from './intersectSegments';\n\n/**\n * This is a brute force solution with O(n^2) performance.\n * (`n` is number of segments).\n * \n * Use this when number of lines is low, and number of intersections\n * is high.\n */\nexport default function brute(lines, options) {\n  var results = [];\n  var reportIntersection = (options && options.onFound) || \n                            defaultIntersectionReporter;\n  var asyncState;\n\n  return {\n    /**\n     * Execute brute force of the segment intersection search\n     */\n    run,\n    /**\n     * Access to results array. Works only when you use default onFound() handler\n     */\n    results,\n\n    /**\n     * Performs a single step in the brute force algorithm ()\n     */\n    step\n  }\n\n  function step() {\n    if (!asyncState) {\n      asyncState = {\n        i: 0\n      }\n    }\n    var test = lines[asyncState.i];\n    for (var j = asyncState.i + 1; j < lines.length; ++j) {\n      var other = lines[j];\n      var pt = intersectSegments(test, other);\n      if (pt) {\n        if (reportIntersection(pt, [test, other])) {\n          return;\n        }\n      }\n    }\n    asyncState.i += 1;\n    return asyncState.i < lines.length;\n  }\n\n  function run() {\n    for(var i = 0; i < lines.length; ++i) {\n      var test = lines[i];\n      for (var j = i + 1; j < lines.length; ++j) {\n        var other = lines[j];\n        var pt = intersectSegments(test, other);\n        if (pt) {\n          if (reportIntersection(pt, [test, other])) {\n            return;\n          }\n        }\n      }\n    }\n    return results;\n  }\n\n  function defaultIntersectionReporter(p, interior) {\n    results.push({\n      point: p, \n      segments: interior\n    });\n  }\n}","import Flatbush from 'flatbush';\nimport intersectSegments from './intersectSegments';\n\n/**\n * This implementation is inspired by discussion here \n * https://twitter.com/mourner/status/1049325199617921024 and \n * here https://github.com/anvaka/isect/issues/1\n * \n * It builds an index of all segments using static spatial index\n * and then for each segment it queries overlapping rectangles.\n */\nexport default function bush(lines, options) {\n  var results = [];\n  var reportIntersection = (options && options.onFound) || \n                            defaultIntersectionReporter;\n  var asyncState;\n\n  var index = new Flatbush(lines.length);\n  lines.forEach(addToIndex);\n  index.finish();\n\n  return {\n    run: run,\n    step: step,\n    results: results,\n\n    // undocumented, don't use unless you know what you are doing:\n    checkIntersection: checkIntersection\n  }\n\n  function run() {\n    for (var i = 0; i < lines.length; ++i) {\n      if (checkIntersection(lines[i], i)) {\n        return; // stop early\n      }\n    }\n    return results;\n  }\n\n  function checkIntersection(currentSegment, currentId) {\n    // sorry about code duplication.\n    var minX = currentSegment.from.x; var maxX = currentSegment.to.x;\n    var minY = currentSegment.from.y; var maxY = currentSegment.to.y;\n    var t;\n    if (minX > maxX) { t = minX; minX = maxX; maxX = t; }\n    if (minY > maxY) { t = minY; minY = maxY; maxY = t; }\n\n    var ids = index.search(minX, minY, maxX, maxY);\n\n    for (var i = 0; i < ids.length; ++i) {\n      var segmentIndex = ids[i];\n      if (segmentIndex <= currentId) continue; // we have either reported it, or it is current.\n\n      var otherSegment = lines[segmentIndex];\n      var point = intersectSegments(otherSegment, currentSegment);\n\n      if (point) {\n        if (reportIntersection(point, [currentSegment, otherSegment])) {\n          // stop early\n          return true;\n        }\n      }\n    }\n  }\n\n  function step() {\n    if (!asyncState) {\n      asyncState = {i: 0};\n    }\n    var test = lines[asyncState.i];\n    checkIntersection(test, asyncState.i);\n    asyncState.i += 1;\n    return asyncState.i < lines.length;\n  }\n\n\n  function addToIndex(line) {\n    var minX = line.from.x; var maxX = line.to.x;\n    var minY = line.from.y; var maxY = line.to.y;\n    var t;\n    if (minX > maxX) { t = minX; minX = maxX; maxX = t; }\n    if (minY > maxY) { t = minY; minY = maxY; maxY = t; }\n    index.add(minX, minY, maxX, maxY);\n  }\n\n  function defaultIntersectionReporter(p, interior) {\n    results.push({\n      point: p, \n      segments: interior\n    });\n  }\n}","import sweep from './sweep';\nimport brute from './brute';\nimport bush from './bush';\n\nexport {\n  sweep, brute, bush\n}","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_vm._m(0),(!_vm.showLoading)?_c('div',[_c('a',{staticClass:\"action\",attrs:{\"href\":\"#\"},on:{\"click\":function($event){$event.preventDefault();_vm.generateNew()}}},[_vm._v(\"Generate New Demo\")])]):_vm._e(),(_vm.showMetrics)?_c('div',{staticClass:\"results\"},[_c('div',[_c('strong',[_vm._v(_vm._s(_vm.linesCount))]),_vm._v(\" lines. Found \"),_c('strong',[_vm._v(_vm._s(_vm.found))]),_vm._v(\" intersections in \"),_c('strong',[_vm._v(_vm._s(_vm.elapsed))])])]):_vm._e(),(_vm.showLoading)?_c('div',{staticClass:\"loading-container\"},[_c('div',{staticClass:\"loader\"},[_vm._v(\"Finding intersections...\")]),_c('div',{staticClass:\"label\"},[_vm._v(\"Finding intersections...\")])]):_vm._e(),(_vm.error)?_c('div',{staticClass:\"error\"},[_vm._v(\"\\n    Asserting failed in sweep line.\\n  \")]):_vm._e(),_c('a',{staticClass:\"info\",attrs:{\"href\":\"https://github.com/anvaka/isect\"}},[_vm._v(\"Source code\")])])}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h3',[_c('strong',[_vm._v(\"isect\")]),_vm._v(\" - intersection detection library\")])}]\n\nexport { render, staticRenderFns }","export default {\n  error: null,\n  showMetrics: false,\n  showLoading: false,\n  elapsed: 0,\n  found: 0,\n  linesCount: 0,\n}","var createRandom = require('ngraph.random');\nvar prng = createRandom(42);\n\nvar params = [\n  {\n    name: 'random',\n    algorithm: ['brute', 'bush'],\n    args: [\n      {min: 100, max: 500},  // number of lines\n      {min: 100, max: 200},  // visible area\n    ]\n  },\n  {\n    name: 'complete',\n    algorithm: ['brute', 'bush'],\n    args: [\n      {min: 10, max: 40},  // number of nodes\n      function p1(qs) {\n        return Math.round((10 + prng.gaussian()) * qs.p0);\n        // {min: 400, max: 600},  // visible area\n      }\n    ]\n  },\n  {\n    name: 'cube',\n    algorithm: ['brute', 'bush'],\n    args: [\n      {min: 100, max: 150},  // number of rects\n      function p2() {\n        return Math.round((10 + prng.gaussian()));\n      }\n    ]\n  },\n  {\n    name: 'drunkgrid',\n    algorithm: ['brute', 'bush'],\n    args: [\n      {min: 10, max: 150},  // Row x Col\n      function p2(qs) {\n        var v = Math.round(Math.random() * 10) + 1;\n        if (v === 0) return 0;\n        if (qs.p0 > 20 && v < 1) v = 3;\n        return v;\n      }\n    ]\n  },\n  {\n    name: 'sparse',\n    algorithm: ['bush', 'bush', 'sweep'],\n    args: [\n      {min: 50, max: 300},  // Count  \n    ]\n  },\n  {\n    name: 'triangle',\n    algorithm(qs) {\n      // sparse is better with sweep\n      return (qs.p1 > 7) ? 'brute' : 'bush'\n    },\n    args: [\n      {min: 10, max: 30},  // Count  \n      {min: 1, max: 20},  // Count  \n    ]\n  },\n  {\n    name: 'splash',\n    algorithm: ['sweep', 'bush'],\n    args: [\n      {min: 10, max: 50},  // Number of lines  \n      {min: 40, max: 70},  // squared variance  \n    ]\n  },\n  {\n    name: 'island',\n    algorithm: ['sweep', 'bush'],\n    args: [\n      {min: 3, max: 10},  // Number of control points on circle\n      {min: 6, max: 11},  // Number of subdivisions\n    ]\n  }\n]\n\nexport default function generateRandomExample() {\n  var generatorIdx = Math.round(Math.random() * (params.length - 1));\n  var generator = params[generatorIdx];\n\n  var qs = {\n    generator: generator.name\n  }\n  generator.args.forEach((range, idx) => {\n    var keyName = `p${idx}`;\n    if (typeof range === 'function') {\n      qs[keyName] = range(qs);\n    } else  {\n      qs[keyName] = Math.round(Math.random() * (range.max - range.min) + range.min);\n    }\n  });\n  var algorithm = 'sweep';\n  if (Array.isArray(generator.algorithm)) {\n    var randomIndex = Math.round(Math.random() * (generator.algorithm.length - 1));\n    algorithm = generator.algorithm[randomIndex];\n  } else if (typeof generator.algorithm === 'function') {\n    algorithm = generator.algorithm(qs);\n  } else if (typeof generator.algorithm === 'string') {\n    algorithm = generator.algorithm;\n  }\n  qs.algorithm = algorithm;\n\n  return qs;\n}","var eventify = require('ngraph.events');\nconst bus = eventify({});\n\nexport default bus;","<template>\n  <div id=\"app\">\n    <h3><strong>isect</strong> - intersection detection library</h3>\n    <div v-if='!showLoading'>\n      <a href='#' @click.prevent='generateNew()' class='action'>Generate New Demo</a>\n    </div>\n    <div v-if='showMetrics' class='results'>\n      <div><strong>{{linesCount}}</strong> lines. Found <strong>{{found}}</strong> intersections in <strong>{{elapsed}}</strong></div>\n    </div>\n    <div v-if='showLoading' class='loading-container'>\n      <div class='loader'>Finding intersections...</div>\n      <div class='label'>Finding intersections...</div>\n    </div>\n    <div class='error' v-if='error'>\n      Asserting failed in sweep line.\n    </div>\n    <a href='https://github.com/anvaka/isect' class='info'>Source code</a>\n  </div>\n</template>\n\n<script>\nimport appState from './appStatus.js';\nimport generateRandomExample from './generateRandomExample';\nimport bus from './bus';\n\nexport default {\n  name: 'app',\n  props: ['state'],\n  data() {\n    return appState;\n  },\n  mounted() {\n    bus.fire('app-loaded');\n  },\n  methods: {\n    generateNew() {\n      this.showLoading = true;\n      this.showMetrics = false;\n      var newState = generateRandomExample();\n      bus.fire('change-qs', newState);\n    }\n  },\n}\n</script>\n\n<style>\n#app {\n  width: 400px;\n  position: absolute;\n  padding: 8px;\n  background: #101830;\n}\na.action {\n  color: #fff;\n  font-size: 16px;\n  padding: 8px;\n  flex: 1;\n  border: 1px solid #99c5f1;\n  justify-content: center;\n  align-items: center;\n  display: flex;\n}\nh3 {\n  margin: 7px 0;\n  font-weight: normal;\n}\nh3 strong {\n  font-weight: bold;\n}\na {\n  text-decoration: none;\n}\n.results {\n  margin-top: 7px;\n}\n.error {\n  background: orangered;\n  margin: 0 -8px;\n  padding: 0 8px;\n}\n\n.info {\n  position: fixed;\n  right: 8px;\n  top: 8px;\n  color: white;\n  border-bottom: 1px dashed;\n}\n\n@media (max-width: 600px) {\n  #app {\n    width: 100%;\n    margin: 0px;\n    padding: 0px;\n  }\n  .results {\n    font-size: 12px;\n    margin: 7px;\n  }\n  h3 {\n    margin: 7px;\n  }\n  .error {\n    padding: 0 7px;\n    margin: 0;\n  }\n\n  .info {\n    bottom: 42px;\n    left: 8px;\n    right: inherit;\n    top: inherit;\n  }\n}\n.loading-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 38px;\n  border: 1px solid #777;\n}\n\n.loading-container .label {\n  margin-left: 8px;\n}\n\n.loader,\n.loader:before,\n.loader:after {\n  border-radius: 50%;\n}\n.loader {\n  color: #ffffff;\n  font-size: 2px;\n  text-indent: -99999em;\n  position: relative;\n  width: 10em;\n  height: 10em;\n  box-shadow: inset 0 0 0 1em;\n  -webkit-transform: translateZ(0);\n  -ms-transform: translateZ(0);\n  transform: translateZ(0);\n}\n.loader:before,\n.loader:after {\n  position: absolute;\n  content: '';\n}\n.loader:before {\n  width: 5.2em;\n  height: 10.2em;\n  background: #101830;\n  border-radius: 10.2em 0 0 10.2em;\n  top: -0.1em;\n  left: -0.1em;\n  -webkit-transform-origin: 5.2em 5.1em;\n  transform-origin: 5.2em 5.1em;\n  -webkit-animation: load2 2s infinite ease 1.5s;\n  animation: load2 2s infinite ease 1.5s;\n}\n.loader:after {\n  width: 5.2em;\n  height: 10.2em;\n  background: #101830;\n  border-radius: 0 10.2em 10.2em 0;\n  top: -0.1em;\n  left: 5.1em;\n  -webkit-transform-origin: 0px 5.1em;\n  transform-origin: 0px 5.1em;\n  -webkit-animation: load2 2s infinite ease;\n  animation: load2 2s infinite ease;\n}\n@-webkit-keyframes load2 {\n  0% {\n    -webkit-transform: rotate(0deg);\n    transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n@keyframes load2 {\n  0% {\n    -webkit-transform: rotate(0deg);\n    transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n</style>\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=d501ed2a&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\nimport style0 from \"./App.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\ncomponent.options.__file = \"App.vue\"\nexport default component.exports","export default class BBox {\n  constructor() {\n    this.minX = Number.POSITIVE_INFINITY;\n    this.minY = Number.POSITIVE_INFINITY;\n    this.maxX = Number.NEGATIVE_INFINITY;\n    this.maxY = Number.NEGATIVE_INFINITY;\n  }\n\n  growBy(offset) {\n    this.minX -= offset;\n    this.minY -= offset;\n    this.maxX += offset;\n    this.maxY += offset;\n  }\n\n  get left() {\n    return this.minX;\n  }\n\n  get top() {\n    return this.minY;\n  }\n\n  get right() {\n    return this.maxX;\n  }\n\n  get bottom() {\n    return this.maxY;\n  }\n\n  get width() {\n    return this.maxX - this.minX;\n  }\n\n  get height() {\n    return this.maxY - this.minY;\n  }\n\n  get cx() {\n    return (this.minX + this.maxX)/2;\n  }\n\n  get cy() {\n    return (this.minY + this.maxY)/2;\n  }\n\n  addPoint(xIn, yIn) {\n    if (xIn === undefined) throw new Error('Point is not defined');\n    let x = xIn;\n    let y = yIn;\n    if (y === undefined) {\n      // xIn is a point object\n      x = xIn.x;\n      y = xIn.y;\n    }\n\n    if (x < this.minX) this.minX = x;\n    if (x > this.maxX) this.maxX = x;\n    if (y < this.minY) this.minY = y;\n    if (y > this.maxY) this.maxY = y;\n  }\n\n  addRect(rect) {\n    if (!rect) throw new Error('rect is not defined');\n    this.addPoint(rect.left, rect.top);\n    this.addPoint(rect.right, rect.top);\n    this.addPoint(rect.left, rect.bottom);\n    this.addPoint(rect.right, rect.bottom);\n  }\n\n  merge(otherBBox) {\n    if (otherBBox.minX < this.minX) this.minX = otherBBox.minX;\n    if (otherBBox.minY < this.minY) this.minY = otherBBox.minY;\n    if (otherBBox.maxX > this.maxX) this.maxX = otherBBox.maxX;\n    if (otherBBox.maxY > this.maxY) this.maxY = otherBBox.maxY;\n  }\n}","import BBox from './BBox';\nimport appStatus from './appStatus';\n\nexport default createScene;\n\nlet isect = require('../../../');\nlet wgl = require('w-gl');\n\nfunction createScene(options, canvas) {\n  var lines = options.lines;\n  var isAsync = options.isAsync;\n  var algorithmName = options.algorithm;\n  var scene = wgl.scene(canvas);\n  scene.setClearColor( 0x0C/255, 0x18/255, 0x34/255, 1);\n  var bounds = new BBox();\n  lines.forEach(line => {\n    bounds.addPoint(line.from);\n    bounds.addPoint(line.to);\n  });\n\n  var pixelRatio = scene.getPixelRatio();\n  var left = bounds.left / pixelRatio;\n  var top = bounds.top / pixelRatio;\n  scene.setViewBox({\n    left, top,\n    right:  left + bounds.width / pixelRatio,\n    bottom: top + bounds.height / pixelRatio\n  })\n\n  // var guidelines = new wgl.WireCollection(lines.length);\n  // guidelines.color = {r: 0.1, g: 0.4, b: 0.8, a: 0.9};\n\n  // ([\n  //   {from: {x: -100, y: 0}, to: {x: 100, y: 0}},\n  //   {from: {x: 0, y: -100}, to: {x: 0, y: 100}},\n  // ]).forEach(function (line) {\n  //   guidelines.add({ from: line.from, to: line.to });\n  // });\n\n  // scene.appendChild(guidelines);\n\n  var linesEl = new wgl.WireCollection(lines.length);\n  linesEl.color.r = 0xee/255;\n  linesEl.color.g = 0xee/255;\n  linesEl.color.b = 0xee/255;\n  linesEl.color.a = 0.9;\n  lines.forEach(function (line) {\n    linesEl.add({ from: line.from, to: line.to });\n  });\n\n  scene.appendChild(linesEl);\n\n  var iSector, nodeCollection;\n  var status = {};\n  var nextFrame;\n\n  var totalElapsed = 0;\n  appStatus.showMetrics = false;\n  appStatus.showLoading = true;\n  // Need to start a bit later, so that vue catches up with UI updates\n  var startTheDemoHandle = setTimeout(startTheDemo, 80);\n\n  return {\n    dispose\n  }\n\n  function startTheDemo() {\n    appStatus.error = null;\n    if (isAsync) {\n      runAsync();\n    } else {\n      runSync();\n    }\n    appStatus.showLoading = false;\n    appStatus.showMetrics = true;\n  }\n\n  function runSync() {\n    // eslint-disable-next-line\n    var startTime = window.performance.now();\n    iSector = isect[algorithmName](lines, { onError });\n    try {\n      var intersections = iSector.run();\n    } catch (e) {\n      // Error is reported in the onError.\n      // eslint-disable-next-line\n      console.error(e);\n      // fall back to brute force.\n      intersections = isect.brute(lines).run();\n    }\n    var elapsed = window.performance.now() - startTime;\n    // eslint-disable-next-line\n    console.log('finished in ' + elapsed + 'ms')\n    if (intersections) {\n      // eslint-disable-next-line\n      console.log('found ' + intersections.length + ' intersections');\n      updateSearchMetrics(elapsed);\n      drawIntersections(intersections)\n    }\n  }\n\n  function onError(err) {\n    appStatus.error = 'Rounding error detected';\n    drawSweepStatus(iSector.sweepStatus);\n    drawIntersections(iSector.results);\n    throw new Error(err);\n  }\n\n  function runAsync() {\n    var start = performance.now();\n    // only sweep line supports async running at the moment\n    iSector = isect[algorithmName](lines, { onError });\n    var end = performance.now();\n    totalElapsed += (end - start);\n    updateSearchMetrics(totalElapsed);\n\n    nextFrame = requestAnimationFrame(frame);\n\n    // for console driven debugging\n    window.next = () => {\n      var hasMore = iSector.step();\n      if (iSector.sweepStatus) {\n        drawSweepStatus(iSector.sweepStatus);\n        iSector.sweepStatus.printStatus();\n      }\n      drawIntersections(iSector.results)\n      return hasMore;\n    }\n  }\n\n  function updateSearchMetrics(elapsed) {\n    appStatus.found = formatWithDecimalSeparator(iSector.results.length);\n    appStatus.elapsed = (Math.round(elapsed * 100)/100) + 'ms';\n    appStatus.linesCount = formatWithDecimalSeparator(lines.length);\n  }\n\n  function dispose() {\n    if (nextFrame) {\n      cancelAnimationFrame(nextFrame);\n      nextFrame = 0;\n    }\n    scene.dispose();\n    clearTimeout(startTheDemoHandle);\n    startTheDemoHandle = 0;\n  }\n\n  function frame() {\n    var hasMore;\n    var start = performance.now();\n    for (var i = 0; i < options.stepsPerFrame; ++i) {\n      hasMore = iSector.step();\n    }\n    var end = performance.now();\n    totalElapsed += end - start;\n    updateSearchMetrics(totalElapsed);\n\n    drawSweepStatus(iSector.sweepStatus);\n    drawIntersections(iSector.results)\n\n    if (hasMore) {\n      nextFrame = requestAnimationFrame(frame);\n    } else {\n      nextFrame = null;\n    }\n  }\n\n  function drawSweepStatus(sweepStatus) {\n    if (!sweepStatus) return;\n\n    var pt = sweepStatus.getLastPoint();\n    if (status.point) {\n      scene.removeChild(status.point);\n    }\n\n    status.point = new wgl.PointCollection(1);\n    var ui = status.point.add(pt);\n    ui.setColor({r: 1, g: 0, b: 0});\n    scene.appendChild(status.point);\n\n    // status line\n    if (status.line) {\n      scene.removeChild(status.line);\n    }\n    status.line = new wgl.WireCollection(1);\n    status.line.color = {r: 0.1, g: 1.0, b: 1.0, a: 0.9};\n    status.line.add({ from: {\n      x: -1000, y: pt.y\n    }, to: {x: 1000, y: pt.y} });\n    scene.appendChild(status.line);\n\n    // lines\n    if (status.segments) {\n      scene.removeChild(status.segments);\n    }\n    var segments = sweepStatus.status.keys();\n    status.segments = new wgl.WireCollection(segments.length);\n    status.segments.color = {r: 0.1, g: 1.0, b: 0.0, a: 0.9};\n    segments.forEach(s => {\n      status.segments.add({ from: s.from, to: s.to });\n    })\n\n    scene.appendChild(status.segments);\n  }\n\n  function drawIntersections(intersections) {\n    if (nodeCollection) {\n      scene.removeChild(nodeCollection)\n      nodeCollection = null;\n    }\n    if (intersections.length > 0) {\n      nodeCollection = new wgl.PointCollection(intersections.length);\n      intersections.forEach((intersect, id) => {\n        var ui = nodeCollection.add(intersect.point, id);\n        ui.setColor({r: 0xA3/244, g: 0x255/255, b: 0x255/255})\n      })\n      scene.appendChild(nodeCollection);\n    }\n  }\n}\n\nfunction formatWithDecimalSeparator(x) {\n  return x.toString().replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n}","var createRandom = require('ngraph.random');\nvar seed = +new Date();\nvar prng = createRandom(seed);\n\nexport function splash(linesCount, minMax) {\n  var lines = [];\n  for (var j = 0; j < linesCount; ++j) {\n    var r = prng.gaussian() * minMax;\n    var alpha = prng.gaussian() * Math.PI * 2;\n    var points = getArr({\n      x: prng.gaussian(),\n      y: prng.gaussian() \n    }, {\n      x: r * Math.cos(alpha), \n      y: r * Math.sin(alpha)\n    }, 7);\n\n    for (var i = 1; i < points.length; ++i) {\n      lines.push({\n        from: points[i - 1],\n        to: points[i]\n      })\n    }\n  }\n  return lines;\n}\n\nexport function island(pointsCount, bands) {\n  var r = 100 * Math.sqrt(bands);\n  var da = 2 * Math.PI/pointsCount;\n  var angle = prng.gaussian();\n  var lines = [];\n  var end = {\n    x: r * Math.cos(angle),\n    y: r * Math.sin(angle)\n  };\n  var from = end;\n\n  for (var j = 0; j < pointsCount; ++j) {\n    r = prng.nextDouble() * 100;\n    angle += da;\n    var to = j < pointsCount - 1 ? {\n      x: r * Math.cos(angle),\n      y: r * Math.sin(angle)\n    } : end; // close the loop.\n    var points = getArr(from, to, bands);\n    for (var i = 1; i < points.length; ++i) {\n      lines.push({\n        from: points[i - 1],\n        to:   points[i]\n      })\n    }\n    from = to;\n  }\n\n  return lines;\n}\n\nfunction getArr(tMin, tMax, bands = 8) {\n  var arr = [tMin, tMax];\n  var dx = tMax.x - tMin.x;\n  var dy = tMax.y - tMin.y;\n  var l = Math.sqrt(dx * dx + dy * dy);\n  var variance = l;\n\n  for (var j = 0; j < bands; ++j) {\n    var newArr = [];\n    // fill in intermediate entries\n    for (var i = 1; i < arr.length; i += 1) {\n      var prev = arr[i - 1];\n\n      var mid = interpolate(prev, arr[i], Math.sqrt(variance));\n      newArr.push(prev, mid);\n    }\n    newArr.push(arr[arr.length - 1]);\n    variance /= 2;\n    arr = newArr;\n  }\n  return arr;\n}\n\nfunction interpolate(p0, p1, variance) {\n  return {\n    x: (p0.x + p1.x) * 0.5 + prng.gaussian() * variance,\n    y: (p0.y + p1.y) * 0.5 + prng.gaussian() * variance,\n  }\n}","/** TODO: How do I remove duplicates from here and perf? */\nvar createRandom = require('ngraph.random');\nvar seed = +new Date();\nvar prng = createRandom(seed);\n\nexport * from './brownian';\n\nexport function random(count = 4, range = 100, seed) {\n  seed = 1536687392180\n  if (seed !== undefined) {\n    prng = createRandom(seed);\n  }\n  var lines = [];\n  for (var i = 0; i < count; ++i) {\n    lines.push({\n      from: {x: (prng.nextDouble() - 0.5) * range, y: (prng.nextDouble() - 0.5) * range},\n      to: {x: (prng.nextDouble() - 0.5) * range, y: (prng.nextDouble() - 0.5) * range}\n    });\n  }\n  return lines;\n}\n\nexport function parallelSlanted(count) {\n  var lines = [];\n  for (var i = 0; i < count; ++i) {\n    var x = -i, y = i;\n    lines.push({\n      from: {x, y},\n      to: {x: i, y: i + i}\n    })\n  }\n  return lines;\n}\n\nexport function sparse(size = 50) {\n  var lines = [];\n  var rows = size, columns = size;\n  for (var j = 0; j < rows; ++j) {\n    for (var i = 0; i < columns; ++i) {\n      var x = i * 10, y = j * 10;\n      var a = prng.gaussian();\n\n      lines.push({\n        from: {x, y},\n        to: {x: x + 10 * Math.cos(a), y: y + 10 * Math.sin(a)}\n      });\n    }\n  }\n  return lines;\n}\n\nexport function triangle(count = 4, variance = 10) {\n  // return [\n  //   { from: { x: 0, y: 2 }, to: { x: 0, y: 2 }, name: \"B0,2\"},\n  //   { from: { x: -4, y: 0}, to: { x: 2, y: 0 }, name: \"B2,0\"},\n  //   { from: { x: -1, y: 6}, to: { x: 2, y: 0 }, name: \"D2,0\"},\n  //   { from: { x: 2, y: 2 }, to: { x: 4, y: -3}, name: \"D2,2\"}\n  // ]\n  // return [\n  //   {from: {x: 0, y: 0}, to: {x: 10, y: 10 }, name: 'segment'},\n  //   {from: {x: 5, y: 5}, to: {x: 5, y: 5 }, name: 'point'},\n  // ]\n  // return [\n  //   {from: {x: 0, y: 0}, to: {x: 10, y:   10 }, name: '0-10'},\n  //   {from: {x: 5, y: 5}, to: {x: 15, y:   15 }, name: '5-15'},\n  // ]\n  // return [\n  //   {from: {x: 0, y: 0}, to: {x: 10, y:   0 }, name: 'B0,0'},\n  //   {from: {x: 1, y: 0}, to: {x: 11, y:   0 }, name: 'B1,0'},\n  //   {from: {x: 2, y: 0}, to: {x:  7, y: -10 }, name: 'D2,0'}\n  // ]\n  var lines = [];\n  var step = 5;\n  var idxVar = prng.nextDouble() < 0.5 ? 1 : 0;\n  for (var i = 0; i < count; ++i) {\n    for (var j = 0; j < count; ++j) {\n      var x = step * i;\n      var y = step * j;\n\n      var idxToUse = (i % 2 === idxVar) ? i : j;\n      var angle =  Math.PI * (idxToUse/count - prng.gaussian());\n      drawTriangle(x, y, variance, angle);\n    }\n  }\n\n  return lines;\n\n  function drawTriangle(x, y, width, alpha) {\n    var cp = {x: x + width/2, y: y - width/2};\n    var left = rotate({x: x, y: y}, cp, alpha);\n    var right = rotate({x: x + width, y: y}, cp, alpha);\n    var middle = rotate({x: x + width/2, y: y - width}, cp, alpha);\n\n    lines.push(\n      {from: {x: left.x, y: left.y}, to: {x: right.x, y: right.y}, name: `B${x},${y}`},\n      {from: {x: right.x, y: right.y}, to: {x: middle.x, y: middle.y}, name: `U${x},${y}`},\n      {from: {x: middle.x, y: middle.y}, to: {x: left.x, y: left.y}, name: `D${x},${y}`}\n    )\n  }\n}\n\nfunction rotate(point, center, alpha) {\n  point.x -= center.x;\n  point.y -= center.y;\n\n  var x = Math.cos(alpha) * point.x - point.y * Math.sin(alpha) + center.x;\n  var y = Math.sin(alpha) * point.x + point.y * Math.cos(alpha) + center.y;\n  return {x, y};\n}\n\nexport function cube(count = 4, variance = 10) {\n  var forwardAngle = 0;\n  var r = 4;\n  var dAngle = Math.PI/count;\n\n  var lines = [];\n  for (var i = 0; i < count; ++i) {\n    forwardAngle += dAngle + prng.gaussian() * variance;\n    addRect(forwardAngle, r);\n    r += prng.gaussian() * variance;\n  }\n  return lines;\n\n  function addRect(angle, r) {\n    var x = Math.cos(angle) * r;\n    var y = Math.sin(angle) * r;\n\n    lines.push({\n        from: {x: x, y: y},\n        to: {x: -y, y: x},\n      },\n      {\n        from: {x: -y, y: x},\n        to: {x: -x, y: -y}\n      },\n      {\n        from: {x: -x, y: -y},\n        to: {x: y, y: -x}\n      },\n      {\n        from: {x: y, y: -x},\n        to: {x: x, y: y}\n      }\n    );\n  }\n}\n\nexport function grid(vertical = 10, horizontal = 10) {\n  var lines = [];\n  var dx = 0; var dy = -0.3;\n  for (var i = 0; i < vertical; i += 1) {\n    lines.push({\n      name: 'h' + i,\n      from: {x: dx, y: i + dy},\n      to: {x: dx + (horizontal - 1), y: i + dy}\n    });\n  }\n\n  for (i = 0; i < horizontal; i += 1) {\n    lines.push({\n      name: 'v' + i,\n      from: {x: dx + i, y: dy},\n      to: {x: dx + i, y: (vertical - 1) + dy}\n    });\n  }\n  return lines;\n}\n\nexport function drunkgrid(size = 10, variance = 10) {\n  // return [{\n  //   from: {x: 0, y: 0},\n  //   to: {x: 10, y: 10},\n  // }, {\n  //   from: {x: 5, y: 5},\n  //   to: {x: 20, y: 20},\n  // }]\n  // This setup is very bad..\n  // return [\n  //   {\n  //     \"name\": \"v2\",\n  //     \"from\": {\n  //       \"x\": -0.9065090071796865,\n  //       \"y\": 15.263401779954687\n  //     },\n  //     \"to\": {\n  //       \"x\": 14.340720330320922,\n  //       \"y\": -2.8453003847556446\n  //     },\n  //     \"dy\": 18.108702164710333,\n  //     \"dx\": -15.247229337500608,\n  //     \"angle\": -0.4571069866986017\n  //   },\n  //   {\n  //     \"name\": \"v0\",\n  //     \"from\": {\n  //       \"x\": 7.0121826553229045,\n  //       \"y\": 6.51578380772819\n  //     },\n  //     \"to\": {\n  //       \"x\": -14.33942114543839,\n  //       \"y\": 6.5156799042713605\n  //     },\n  //     \"dy\": 0.00010390345682953495,\n  //     \"dx\": 21.351603800761296,\n  //     \"angle\": 0.9999951337167842\n  //   },\n  //   {\n  //     \"name\": \"v1\",\n  //     \"from\": {\n  //       \"x\": -7.166517787738302,\n  //       \"y\": 10.160876487964895\n  //     },\n  //     \"to\": {\n  //       \"x\": 9.088398499652495,\n  //       \"y\": -15.20648970096957\n  //     },\n  //     \"dy\": 25.367366188934465,\n  //     \"dx\": -16.2549162873908,\n  //     \"angle\": -0.3905339957422227\n  //   },\n  // ]\n  var lines = [];\n  var dx = -2 * variance; var dy = -2 * variance;\n  for (var i = 0; i < size; i += 1) {\n    lines.push({\n      name: 'h' + i,\n      from: {x: dx + prng.gaussian() * variance, y: i + dy + prng.gaussian() * variance},\n      to: {x: dx + (size - 1) + prng.gaussian() * variance, y: i + dy + prng.gaussian() * variance}\n    });\n    lines.push({\n      name: 'v' + i,\n      from: {x: dx + i + prng.gaussian() * variance, y: dy + prng.gaussian() * variance},\n      to: {x: dx + i + prng.gaussian() * variance, y: (size - 1) + dy + prng.gaussian() * variance}\n    });\n  }\n\n  return lines;\n}\n\nexport function complete(count = 10, range = 100) {\n  var angleStep = 2 * Math.PI / count;\n  var lines = [];\n  var seen = new Set();\n\n  for (var i = 0; i < count; ++i) {\n    var angle = angleStep * i;\n    var x = Math.cos(angle) * range / 2;\n    var y = Math.sin(angle) * range / 2;\n    for (var j = 0; j < count; ++j) {\n      if (j !== i) {\n        var ex = Math.cos(angleStep * j) * range / 2;\n        var ey = Math.sin(angleStep * j) * range / 2;\n        var name = `${i},${j}`;\n        var l = {\n          name: name,\n          from: {x: x, y: y},\n          to: {x: ex, y: ey}\n        };\n        var sKey = getKey(i, j);\n        if (!seen.has(sKey)) {\n          lines.push(l);\n          seen.add(sKey)\n        }\n      }\n    }\n  }\n\n  return lines;\n\n  function getKey(i, j) {\n    return i < j ? i + ';' + j : j + ';' + i;\n  }\n}\n","import Vue from 'vue'\nimport App from './App.vue'\nimport createScene from './scene';\n\nimport * as gen from './generators';\nimport queryState from 'query-state';\n\nimport bus from './bus';\n\nvar whitelistedAlgorithms = new Set(['brute', 'bush', 'sweep']);\n\nvar qs = queryState({\n  isAsync: false,\n  p0: 150,\n  p1: 4,\n  generator: 'drunkgrid',\n  algorithm: 'brute',\n}, {\n  useSearch: true\n});\n\nqs.onChange(updateScene);\nbus.on('app-loaded', renderFirstTime);\nbus.on('change-qs', (newState) => {\n  qs.set(newState);\n  updateScene(newState);\n})\n\nvar sceneOptions = getSceneOptions(qs.get());\nvar currentScene;\n\nVue.config.productionTip = false\n\nnew Vue({\n  render: h => h(App)\n}).$mount('#app')\n\n\nfunction renderFirstTime() {\n  currentScene = createScene(sceneOptions, document.getElementById('scene'));\n}\n\nfunction updateScene(appState) {\n  appState.showLoading = true;\n  appState.showMetrics = false;\n  sceneOptions = getSceneOptions(appState);\n  if (currentScene) {\n    currentScene.dispose();\n  }\n  currentScene = createScene(sceneOptions, document.getElementById('scene'));\n}\n\nfunction getSceneOptions(state) {\n  var generator = state.generator;\n  if (!(generator in gen)) {\n    generator = 'drunkgrid'\n  }\n  var p0 = getNumber(state.p0, 50); \n  var p1 = getNumber(state.p1, 4);\n\n  var lines = gen[generator](p0, p1);\n  window.lines = lines;\n  var isAsync = state.isAsync;\n  var stepsPerFrame = getNumber(state.stepsPerFrame, 20);\n  return {\n    lines, \n    isAsync, \n    stepsPerFrame,\n    algorithm: whitelistedAlgorithms.has(state.algorithm) ? state.algorithm : 'bush'\n  }\n}\n\nfunction getNumber(x, defaultValue) {\n  var num = Number.parseFloat(x);\n  return Number.isFinite(num) ? num : defaultValue;\n}","/*!\n * wgl v0.3.1\n * (c) 2017 Andrei Kashcha.\n * Released under the MIT License.\n */\n/**\n * This module unifies handling of mouse whee event across different browsers\n *\n * See https://developer.mozilla.org/en-US/docs/Web/Reference/Events/wheel?redirectlocale=en-US&redirectslug=DOM%2FMozilla_event_reference%2Fwheel\n * for more details\n *\n * Usage:\n *  var addWheelListener = require('wheel').addWheelListener;\n *  var removeWheelListener = require('wheel').removeWheelListener;\n *  addWheelListener(domElement, function (e) {\n *    // mouse wheel event\n *  });\n *  removeWheelListener(domElement, function);\n */\n// by default we shortcut to 'addEventListener':\n\nvar wheel = addWheelListener;\n\n// But also expose \"advanced\" api with unsubscribe:\nvar addWheelListener_1 = addWheelListener;\nvar removeWheelListener_1 = removeWheelListener;\n\n\nvar prefix = \"\";\nvar _addEventListener;\nvar _removeEventListener;\nvar support;\n\ndetectEventModel(typeof window !== 'undefined' && window,\n                typeof document !== 'undefined' && document);\n\nfunction addWheelListener( elem, callback, useCapture ) {\n    _addWheelListener( elem, support, callback, useCapture );\n\n    // handle MozMousePixelScroll in older Firefox\n    if( support == \"DOMMouseScroll\" ) {\n        _addWheelListener( elem, \"MozMousePixelScroll\", callback, useCapture );\n    }\n}\n\nfunction removeWheelListener( elem, callback, useCapture ) {\n    _removeWheelListener( elem, support, callback, useCapture );\n\n    // handle MozMousePixelScroll in older Firefox\n    if( support == \"DOMMouseScroll\" ) {\n        _removeWheelListener( elem, \"MozMousePixelScroll\", callback, useCapture );\n    }\n}\n\n  // TODO: in theory this anonymous function may result in incorrect\n  // unsubscription in some browsers. But in practice, I don't think we should\n  // worry too much about it (those browsers are on the way out)\nfunction _addWheelListener( elem, eventName, callback, useCapture ) {\n  elem[ _addEventListener ]( prefix + eventName, support == \"wheel\" ? callback : function( originalEvent ) {\n    !originalEvent && ( originalEvent = window.event );\n\n    // create a normalized event object\n    var event = {\n      // keep a ref to the original event object\n      originalEvent: originalEvent,\n      target: originalEvent.target || originalEvent.srcElement,\n      type: \"wheel\",\n      deltaMode: originalEvent.type == \"MozMousePixelScroll\" ? 0 : 1,\n      deltaX: 0,\n      deltaY: 0,\n      deltaZ: 0,\n      clientX: originalEvent.clientX,\n      clientY: originalEvent.clientY,\n      preventDefault: function() {\n        originalEvent.preventDefault ?\n            originalEvent.preventDefault() :\n            originalEvent.returnValue = false;\n      },\n      stopPropagation: function() {\n        if(originalEvent.stopPropagation)\n          { originalEvent.stopPropagation(); }\n      },\n      stopImmediatePropagation: function() {\n        if(originalEvent.stopImmediatePropagation)\n          { originalEvent.stopImmediatePropagation(); }\n      }\n    };\n\n    // calculate deltaY (and deltaX) according to the event\n    if ( support == \"mousewheel\" ) {\n      event.deltaY = - 1/40 * originalEvent.wheelDelta;\n      // Webkit also support wheelDeltaX\n      originalEvent.wheelDeltaX && ( event.deltaX = - 1/40 * originalEvent.wheelDeltaX );\n    } else {\n      event.deltaY = originalEvent.detail;\n    }\n\n    // it's time to fire the callback\n    return callback( event );\n\n  }, useCapture || false );\n}\n\nfunction _removeWheelListener( elem, eventName, callback, useCapture ) {\n  elem[ _removeEventListener ]( prefix + eventName, callback, useCapture || false );\n}\n\nfunction detectEventModel(window, document) {\n  if ( window && window.addEventListener ) {\n      _addEventListener = \"addEventListener\";\n      _removeEventListener = \"removeEventListener\";\n  } else {\n      _addEventListener = \"attachEvent\";\n      _removeEventListener = \"detachEvent\";\n      prefix = \"on\";\n  }\n\n  if (document) {\n    // detect available wheel event\n    support = \"onwheel\" in document.createElement(\"div\") ? \"wheel\" : // Modern browsers support \"wheel\"\n              document.onmousewheel !== undefined ? \"mousewheel\" : // Webkit and IE support at least \"mousewheel\"\n              \"DOMMouseScroll\"; // let's assume that remaining browsers are older Firefox\n  } else {\n    support = \"wheel\";\n  }\n}\n\nwheel.addWheelListener = addWheelListener_1;\nwheel.removeWheelListener = removeWheelListener_1;\n\n/**\n * https://github.com/gre/bezier-easing\n * BezierEasing - use bezier curve for transition easing function\n * by Gatan Renaudeau 2014 - 2015  MIT License\n */\n\n// These values are established by empiricism with tests (tradeoff: performance VS precision)\nvar NEWTON_ITERATIONS = 4;\nvar NEWTON_MIN_SLOPE = 0.001;\nvar SUBDIVISION_PRECISION = 0.0000001;\nvar SUBDIVISION_MAX_ITERATIONS = 10;\n\nvar kSplineTableSize = 11;\nvar kSampleStepSize = 1.0 / (kSplineTableSize - 1.0);\n\nvar float32ArraySupported = typeof Float32Array === 'function';\n\nfunction A (aA1, aA2) { return 1.0 - 3.0 * aA2 + 3.0 * aA1; }\nfunction B (aA1, aA2) { return 3.0 * aA2 - 6.0 * aA1; }\nfunction C (aA1)      { return 3.0 * aA1; }\n\n// Returns x(t) given t, x1, and x2, or y(t) given t, y1, and y2.\nfunction calcBezier (aT, aA1, aA2) { return ((A(aA1, aA2) * aT + B(aA1, aA2)) * aT + C(aA1)) * aT; }\n\n// Returns dx/dt given t, x1, and x2, or dy/dt given t, y1, and y2.\nfunction getSlope (aT, aA1, aA2) { return 3.0 * A(aA1, aA2) * aT * aT + 2.0 * B(aA1, aA2) * aT + C(aA1); }\n\nfunction binarySubdivide (aX, aA, aB, mX1, mX2) {\n  var currentX, currentT, i = 0;\n  do {\n    currentT = aA + (aB - aA) / 2.0;\n    currentX = calcBezier(currentT, mX1, mX2) - aX;\n    if (currentX > 0.0) {\n      aB = currentT;\n    } else {\n      aA = currentT;\n    }\n  } while (Math.abs(currentX) > SUBDIVISION_PRECISION && ++i < SUBDIVISION_MAX_ITERATIONS);\n  return currentT;\n}\n\nfunction newtonRaphsonIterate (aX, aGuessT, mX1, mX2) {\n for (var i = 0; i < NEWTON_ITERATIONS; ++i) {\n   var currentSlope = getSlope(aGuessT, mX1, mX2);\n   if (currentSlope === 0.0) {\n     return aGuessT;\n   }\n   var currentX = calcBezier(aGuessT, mX1, mX2) - aX;\n   aGuessT -= currentX / currentSlope;\n }\n return aGuessT;\n}\n\nfunction LinearEasing (x) {\n  return x;\n}\n\nvar src = function bezier (mX1, mY1, mX2, mY2) {\n  if (!(0 <= mX1 && mX1 <= 1 && 0 <= mX2 && mX2 <= 1)) {\n    throw new Error('bezier x values must be in [0, 1] range');\n  }\n\n  if (mX1 === mY1 && mX2 === mY2) {\n    return LinearEasing;\n  }\n\n  // Precompute samples table\n  var sampleValues = float32ArraySupported ? new Float32Array(kSplineTableSize) : new Array(kSplineTableSize);\n  for (var i = 0; i < kSplineTableSize; ++i) {\n    sampleValues[i] = calcBezier(i * kSampleStepSize, mX1, mX2);\n  }\n\n  function getTForX (aX) {\n    var intervalStart = 0.0;\n    var currentSample = 1;\n    var lastSample = kSplineTableSize - 1;\n\n    for (; currentSample !== lastSample && sampleValues[currentSample] <= aX; ++currentSample) {\n      intervalStart += kSampleStepSize;\n    }\n    --currentSample;\n\n    // Interpolate to provide an initial guess for t\n    var dist = (aX - sampleValues[currentSample]) / (sampleValues[currentSample + 1] - sampleValues[currentSample]);\n    var guessForT = intervalStart + dist * kSampleStepSize;\n\n    var initialSlope = getSlope(guessForT, mX1, mX2);\n    if (initialSlope >= NEWTON_MIN_SLOPE) {\n      return newtonRaphsonIterate(aX, guessForT, mX1, mX2);\n    } else if (initialSlope === 0.0) {\n      return guessForT;\n    } else {\n      return binarySubdivide(aX, intervalStart, intervalStart + kSampleStepSize, mX1, mX2);\n    }\n  }\n\n  return function BezierEasing (x) {\n    // Because JavaScript number are imprecise, we should guarantee the extremes are right.\n    if (x === 0) {\n      return 0;\n    }\n    if (x === 1) {\n      return 1;\n    }\n    return calcBezier(getTForX(x), mY1, mY2);\n  };\n};\n\n// Predefined set of animations. Similar to CSS easing functions\nvar animations = {\n  ease:  src(0.25, 0.1, 0.25, 1),\n  easeIn: src(0.42, 0, 1, 1),\n  easeOut: src(0, 0, 0.58, 1),\n  easeInOut: src(0.42, 0, 0.58, 1),\n  linear: src(0, 0, 1, 1)\n};\n\n\nvar amator = animate;\nvar makeAggregateRaf_1 = makeAggregateRaf;\nvar sharedScheduler = makeAggregateRaf();\n\n\nfunction animate(source, target, options) {\n  var start = Object.create(null);\n  var diff = Object.create(null);\n  options = options || {};\n  // We let clients specify their own easing function\n  var easing = (typeof options.easing === 'function') ? options.easing : animations[options.easing];\n\n  // if nothing is specified, default to ease (similar to CSS animations)\n  if (!easing) {\n    if (options.easing) {\n      console.warn('Unknown easing function in amator: ' + options.easing);\n    }\n    easing = animations.ease;\n  }\n\n  var step = typeof options.step === 'function' ? options.step : noop$1;\n  var done = typeof options.done === 'function' ? options.done : noop$1;\n\n  var scheduler = getScheduler(options.scheduler);\n\n  var keys = Object.keys(target);\n  keys.forEach(function(key) {\n    start[key] = source[key];\n    diff[key] = target[key] - source[key];\n  });\n\n  var durationInMs = typeof options.duration === 'number' ? options.duration : 400;\n  var durationInFrames = Math.max(1, durationInMs * 0.06); // 0.06 because 60 frames pers 1,000 ms\n  var previousAnimationId;\n  var frame = 0;\n\n  previousAnimationId = scheduler.next(loop);\n\n  return {\n    cancel: cancel\n  }\n\n  function cancel() {\n    scheduler.cancel(previousAnimationId);\n    previousAnimationId = 0;\n  }\n\n  function loop() {\n    var t = easing(frame/durationInFrames);\n    frame += 1;\n    setValues(t);\n    if (frame <= durationInFrames) {\n      previousAnimationId = scheduler.next(loop);\n      step(source);\n    } else {\n      previousAnimationId = 0;\n      setTimeout(function() { done(source); }, 0);\n    }\n  }\n\n  function setValues(t) {\n    keys.forEach(function(key) {\n      source[key] = diff[key] * t + start[key];\n    });\n  }\n}\n\nfunction noop$1() { }\n\nfunction getScheduler(scheduler) {\n  if (!scheduler) {\n    var canRaf = typeof window !== 'undefined' && window.requestAnimationFrame;\n    return canRaf ? rafScheduler() : timeoutScheduler()\n  }\n  if (typeof scheduler.next !== 'function') { throw new Error('Scheduler is supposed to have next(cb) function') }\n  if (typeof scheduler.cancel !== 'function') { throw new Error('Scheduler is supposed to have cancel(handle) function') }\n\n  return scheduler\n}\n\nfunction rafScheduler() {\n  return {\n    next: window.requestAnimationFrame.bind(window),\n    cancel: window.cancelAnimationFrame.bind(window)\n  }\n}\n\nfunction timeoutScheduler() {\n  return {\n    next: function(cb) {\n      return setTimeout(cb, 1000/60)\n    },\n    cancel: function (id) {\n      return clearTimeout(id)\n    }\n  }\n}\n\nfunction makeAggregateRaf() {\n  var frontBuffer = new Set();\n  var backBuffer = new Set();\n  var frameToken = 0;\n\n  return {\n    next: next,\n    cancel: next,\n    clearAll: clearAll\n  }\n\n  function clearAll() {\n    frontBuffer.clear();\n    backBuffer.clear();\n    cancelAnimationFrame(frameToken);\n    frameToken = 0;\n  }\n\n  function next(callback) {\n    backBuffer.add(callback);\n    renderNextFrame();\n  }\n\n  function renderNextFrame() {\n    if (!frameToken) { frameToken = requestAnimationFrame(renderFrame); }\n  }\n\n  function renderFrame() {\n    frameToken = 0;\n\n    var t = backBuffer;\n    backBuffer = frontBuffer;\n    frontBuffer = t;\r\n\n    frontBuffer.forEach(function(callback) {\n      callback();\n    });\n    frontBuffer.clear();\n  }\n\n  \n}\n\namator.makeAggregateRaf = makeAggregateRaf_1;\namator.sharedScheduler = sharedScheduler;\n\n/**\n * Allows smooth kinetic scrolling of the surface\n */\nvar kinetic_1 = kinetic;\n\nfunction kinetic(getPoint, scroll, settings) {\n  if (typeof settings !== 'object') {\n    // setting could come as boolean, we should ignore it, and use an object.\n    settings = {};\n  }\n\n  var minVelocity = (typeof settings.minVelocity === 'number') ? settings.minVelocity : 5;\n  var amplitude = (typeof settings.amplitude === 'number') ? settings.amplitude : 0.25;\n\n  var lastPoint;\n  var timestamp;\n  var timeConstant = 342;\n\n  var ticker;\n  var vx, targetX, ax;\n  var vy, targetY, ay;\n\n  var raf;\n\n  return {\n    start: start,\n    stop: stop,\n    cancel: dispose\n  }\n\n  function dispose() {\n    window.clearInterval(ticker);\n    window.cancelAnimationFrame(raf);\n  }\n\n  function start() {\n    lastPoint = getPoint();\n\n    ax = ay = vx = vy = 0;\n    timestamp = new Date();\n\n    window.clearInterval(ticker);\n    window.cancelAnimationFrame(raf);\n\n    // we start polling the point position to accumulate velocity\n    // Once we stop(), we will use accumulated velocity to keep scrolling\n    // an object.\n    ticker = window.setInterval(track, 100);\n  }\n\n  function track() {\n    var now = Date.now();\n    var elapsed = now - timestamp;\n    timestamp = now;\n\n    var currentPoint = getPoint();\n\n    var dx = currentPoint.x - lastPoint.x;\n    var dy = currentPoint.y - lastPoint.y;\n\n    lastPoint = currentPoint;\n\n    var dt = 1000 / (1 + elapsed);\n\n    // moving average\n    vx = 0.8 * dx * dt + 0.2 * vx;\n    vy = 0.8 * dy * dt + 0.2 * vy;\n  }\n\n  function stop() {\n    window.clearInterval(ticker);\n    window.cancelAnimationFrame(raf);\n\n    var currentPoint = getPoint();\n\n    targetX = currentPoint.x;\n    targetY = currentPoint.y;\n    timestamp = Date.now();\n\n    if (vx < -minVelocity || vx > minVelocity) {\n      ax = amplitude * vx;\n      targetX += ax;\n    }\n\n    if (vy < -minVelocity || vy > minVelocity) {\n      ay = amplitude * vy;\n      targetY += ay;\n    }\n\n    raf = window.requestAnimationFrame(autoScroll);\n  }\n\n  function autoScroll() {\n    var elapsed = Date.now() - timestamp;\n\n    var moving = false;\n    var dx = 0;\n    var dy = 0;\n\n    if (ax) {\n      dx = -ax * Math.exp(-elapsed / timeConstant);\n\n      if (dx > 0.5 || dx < -0.5) { moving = true; }\n      else { dx = ax = 0; }\n    }\n\n    if (ay) {\n      dy = -ay * Math.exp(-elapsed / timeConstant);\n\n      if (dy > 0.5 || dy < -0.5) { moving = true; }\n      else { dy = ay = 0; }\n    }\n\n    if (moving) {\n      scroll(targetX + dx, targetY + dy);\n      raf = window.requestAnimationFrame(autoScroll);\n    }\n  }\n\n}\n\n/* global Event */\nvar createEvent_1 = createEvent;\n\nvar isIE = typeof Event !== 'function';\n\n/**\n * Constructs custom event. Works in IE too\n */\nfunction createEvent(name) {\n  if (isIE) {\n    var evt = document.createEvent('CustomEvent');\n    evt.initCustomEvent(name, true, true, undefined);\n    return evt\n  } else {\n    return new Event(name, {\n      bubbles: true\n    })\n  }\n}\n\n/**\n * Disallows selecting text.\n */\nvar textSelectionInterceptor = createTextSelectionInterceptor;\n\nfunction createTextSelectionInterceptor() {\n  var dragObject;\n  var prevSelectStart;\n  var prevDragStart;\n\n  return {\n    capture: capture,\n    release: release\n  }\n\n  function capture(domObject) {\n    prevSelectStart = window.document.onselectstart;\n    prevDragStart = window.document.ondragstart;\n\n    window.document.onselectstart = disabled;\n\n    dragObject = domObject;\n    dragObject.ondragstart = disabled;\n  }\n\n  function release() {\n    window.document.onselectstart = prevSelectStart;\n    if (dragObject) { dragObject.ondragstart = prevDragStart; }\n  }\n}\n\nfunction disabled(e) {\n  e.stopPropagation();\n  return false\n}\n\nvar transform = Transform;\n\nfunction Transform() {\n  this.x = 0;\n  this.y = 0;\n  this.scale = 1;\n}\n\nvar svgController = makeSvgController;\n\nfunction makeSvgController(svgElement) {\n  var elementValid = (svgElement instanceof SVGElement);\n  if (!elementValid) {\n    throw new Error('svg element is required for svg.panzoom to work')\n  }\n\n  var owner = svgElement.ownerSVGElement;\n  if (!owner) {\n    throw new Error(\n      'Do not apply panzoom to the root <svg> element. ' +\n      'Use its child instead (e.g. <g></g>). ' +\n      'As of March 2016 only FireFox supported transform on the root element')\n  }\n\n  owner.setAttribute('tabindex', 1); // TODO: not sure if this is really polite\n\n  var api = {\n    getBBox: getBBox,\n    getScreenCTM: getScreenCTM,\n    getOwner: getOwner,\n    applyTransform: applyTransform,\n    initTransform: initTransform\n  };\n  \n  return api\n\n  function getOwner() {\n    return owner\n  }\n\n  function getBBox() {\n    var bbox =  svgElement.getBBox();\n    return {\n      left: bbox.x,\n      top: bbox.y,\n      width: bbox.width,\n      height: bbox.height,\n    }\n  }\n\n  function getScreenCTM() {\n    return owner.getScreenCTM()\n  }\n\n  function initTransform(transform) {\n    var screenCTM = svgElement.getScreenCTM();\n    transform.x = screenCTM.e;\n    transform.y = screenCTM.f;\n    transform.scale = screenCTM.a;\n    owner.removeAttributeNS(null, 'viewBox');\n  }\n\n  function applyTransform(transform) {\n    svgElement.setAttribute('transform', 'matrix(' +\n      transform.scale + ' 0 0 ' +\n      transform.scale + ' ' +\n      transform.x + ' ' + transform.y + ')');\n  }\n}\n\nvar domController = makeDomController;\n\nfunction makeDomController(domElement) {\n  var elementValid = (domElement instanceof HTMLElement);\n  if (!elementValid) {\n    throw new Error('svg element is required for svg.panzoom to work')\n  }\n\n  var owner = domElement.parentElement;\n  if (!owner) {\n    throw new Error(\n      'Do not apply panzoom to the detached DOM element. '\n    )\n  }\n\n  domElement.scrollTop = 0;\n  owner.setAttribute('tabindex', 1); // TODO: not sure if this is really polite\n\n  var api = {\n    getBBox: getBBox,\n    getOwner: getOwner,\n    applyTransform: applyTransform,\n  };\n  \n  return api\n\n  function getOwner() {\n    return owner\n  }\n\n  function getBBox() {\n    // TODO: We should probably cache this?\n    return  {\n      left: 0,\n      top: 0,\n      width: domElement.clientWidth,\n      height: domElement.clientHeight\n    }\n  }\n\n  function applyTransform(transform) {\n    // TODO: Should we cache this?\n    domElement.style.transformOrigin = '0 0 0';\n    domElement.style.transform = 'matrix(' +\n      transform.scale + ', 0, 0, ' +\n      transform.scale + ', ' +\n      transform.x + ', ' + transform.y + ')';\n  }\n}\n\n/* globals SVGElement */\n/**\n * Allows to drag and zoom svg elements\n */\n\n\n\n\nvar preventTextSelection = textSelectionInterceptor();\n\n\n\n\nvar defaultZoomSpeed = 0.065;\nvar defaultDoubleTapZoomSpeed = 1.75;\nvar doubleTapSpeedInMS = 300;\n\nvar panzoom = createPanZoom;\n\n/**\n * Creates a new instance of panzoom, so that an object can be panned and zoomed\n *\n * @param {DOMElement} domElement where panzoom should be attached.\n * @param {Object} options that configure behavior.\n */\nfunction createPanZoom(domElement, options) {\n  options = options || {};\n\n  var domController$$1 = options.controller;\n\n  if (!domController$$1) {\n    if (domElement instanceof SVGElement) {\n      domController$$1 = svgController(domElement);\n    }\n\n    if (domElement instanceof HTMLElement) {\n      domController$$1 = domController(domElement);\n    }\n  }\n\n  if (!domController$$1) {\n    throw new Error('Cannot create panzoom for the current type of dom element')\n  }\n  var owner = domController$$1.getOwner();\n  // just to avoid GC pressure, every time we do intermediate transform\n  // we return this object. For internal use only. Never give it back to the consumer of this library\n  var storedCTMResult = {x: 0, y: 0};\n\n  var isDirty = false;\n  var transform$$1 = new transform();\n\n  if (domController$$1.initTransform) {\n    domController$$1.initTransform(transform$$1);\n  }\n\n  var realPinch = typeof options.realPinch === 'boolean' ? options.realPinch : false;\n  var bounds = options.bounds;\n  var maxZoom = typeof options.maxZoom === 'number' ? options.maxZoom : Number.POSITIVE_INFINITY;\n  var minZoom = typeof options.minZoom === 'number' ? options.minZoom : 0;\n\n  var boundsPadding = typeof options.boundsPadding === 'number' ? options.boundsPadding : 0.05;\n  var zoomDoubleClickSpeed = typeof options.zoomDoubleClickSpeed === 'number' ? options.zoomDoubleClickSpeed : defaultDoubleTapZoomSpeed;\n  var beforeWheel = options.beforeWheel || noop;\n  var speed = typeof options.zoomSpeed === 'number' ? options.zoomSpeed : defaultZoomSpeed;\n\n  validateBounds(bounds);\n\n  if (options.autocenter) {\n    autocenter();\n  }\n\n  var frameAnimation;\n\n  var lastTouchEndTime = 0;\n\n  var touchInProgress = false;\n\n  // We only need to fire panstart when actual move happens\n  var panstartFired = false;\n\n  // cache mouse coordinates here\n  var mouseX;\n  var mouseY;\n\n  var pinchZoomLength;\n\n  var smoothScroll;\n  if ('smoothScroll' in options && !options.smoothScroll) {\n    // If user explicitly asked us not to use smooth scrolling, we obey\n    smoothScroll = rigidScroll();\n  } else {\n    // otherwise we use forward smoothScroll settings to kinetic API\n    // which makes scroll smoothing.\n    smoothScroll = kinetic_1(getPoint, scroll, options.smoothScroll);\n  }\n\n  var moveByAnimation;\n  var zoomToAnimation;\n\n  var multitouch;\n  var paused = false;\n\n  listenForEvents();\n\n  return {\n    dispose: dispose,\n    moveBy: internalMoveBy,\n    moveTo: moveTo,\n    centerOn: centerOn,\n    zoomTo: publicZoomTo,\n    zoomAbs: zoomAbs,\n    smoothZoom: smoothZoom,\n    getTransform: getTransformModel,\n    showRectangle: showRectangle,\n\n    pause: pause,\n    resume: resume,\n    isPaused: isPaused,\n  }\n\n  function pause() {\n    releaseEvents();\n    paused = true;\n  }\n\n  function resume() {\n    if (paused) {\n      console.log('resujme');\n      listenForEvents();\n      paused = false;\n    }\n  }\n\n  function isPaused() {\n    return paused;\n  }\n\n  function showRectangle(rect) {\n    // TODO: this duplicates autocenter. I think autocenter should go.\n    var size = transformToScreen(owner.clientWidth, owner.clientHeight);\n\n    var rectWidth = rect.right - rect.left;\n    var rectHeight = rect.bottom - rect.top;\n    if (!Number.isFinite(rectWidth) || !Number.isFinite(rectHeight)) {\n      throw new Error('Invalid rectangle');\n    }\n\n    var dw = size.x/rectWidth;\n    var dh = size.y/rectHeight;\n    var scale = Math.min(dw, dh);\n    transform$$1.x = -(rect.left + rectWidth/2) * scale + size.x/2;\n    transform$$1.y = -(rect.top + rectHeight/2) * scale + size.y/2;\n    transform$$1.scale = scale;\n  }\n\n  function transformToScreen(x, y) {\n    if (domController$$1.getScreenCTM) {\n      var parentCTM = domController$$1.getScreenCTM();\n      var parentScaleX = parentCTM.a;\n      var parentScaleY = parentCTM.d;\n      var parentOffsetX = parentCTM.e;\n      var parentOffsetY = parentCTM.f;\n      storedCTMResult.x = x * parentScaleX - parentOffsetX;\n      storedCTMResult.y = y * parentScaleY - parentOffsetY;\n    } else {\n      storedCTMResult.x = x;\n      storedCTMResult.y = y;\n    }\n\n    return storedCTMResult\n  }\n\n  function autocenter() {\n    var w; // width of the parent\n    var h; // height of the parent\n    var left = 0;\n    var top = 0;\n    var sceneBoundingBox = getBoundingBox();\n    if (sceneBoundingBox) {\n      // If we have bounding box - use it.\n      left = sceneBoundingBox.left;\n      top = sceneBoundingBox.top;\n      w = sceneBoundingBox.right - sceneBoundingBox.left;\n      h = sceneBoundingBox.bottom - sceneBoundingBox.top;\n    } else {\n      // otherwise just use whatever space we have\n      var ownerRect = owner.getBoundingClientRect();\n      w = ownerRect.width;\n      h = ownerRect.height;\n    }\n    var bbox = domController$$1.getBBox();\n    if (bbox.width === 0 || bbox.height === 0) {\n      // we probably do not have any elements in the SVG\n      // just bail out;\n      return;\n    }\n    var dh = h/bbox.height;\n    var dw = w/bbox.width;\n    var scale = Math.min(dw, dh);\n    transform$$1.x = -(bbox.left + bbox.width/2) * scale + w/2 + left;\n    transform$$1.y = -(bbox.top + bbox.height/2) * scale + h/2 + top;\n    transform$$1.scale = scale;\n  }\n\n  function getTransformModel() {\n    // TODO: should this be read only?\n    return transform$$1\n  }\n\n  function getPoint() {\n    return {\n      x: transform$$1.x,\n      y: transform$$1.y\n    }\n  }\n\n  function moveTo(x, y) {\n    transform$$1.x = x;\n    transform$$1.y = y;\n\n    keepTransformInsideBounds();\n\n    triggerEvent('pan');\n    makeDirty();\n  }\n\n  function moveBy(dx, dy) {\n    moveTo(transform$$1.x + dx, transform$$1.y + dy);\n  }\n\n  function keepTransformInsideBounds() {\n    var boundingBox = getBoundingBox();\n    if (!boundingBox) { return }\n\n    var adjusted = false;\n    var clientRect = getClientRect();\n\n    var diff = boundingBox.left - clientRect.right;\n    if (diff > 0) {\n      transform$$1.x += diff;\n      adjusted = true;\n    }\n    // check the other side:\n    diff = boundingBox.right - clientRect.left;\n    if (diff < 0) {\n      transform$$1.x += diff;\n      adjusted = true;\n    }\n\n    // y axis:\n    diff = boundingBox.top - clientRect.bottom;\n    if (diff > 0) {\n      // we adjust transform, so that it matches exactly our bounding box:\n      // transform.y = boundingBox.top - (boundingBox.height + boundingBox.y) * transform.scale =>\n      // transform.y = boundingBox.top - (clientRect.bottom - transform.y) =>\n      // transform.y = diff + transform.y =>\n      transform$$1.y += diff;\n      adjusted = true;\n    }\n\n    diff = boundingBox.bottom - clientRect.top;\n    if (diff < 0) {\n      transform$$1.y += diff;\n      adjusted = true;\n    }\n    return adjusted\n  }\n\n  /**\n   * Returns bounding box that should be used to restrict scene movement.\n   */\n  function getBoundingBox() {\n    if (!bounds) { return } // client does not want to restrict movement\n\n    if (typeof bounds === 'boolean') {\n      // for boolean type we use parent container bounds\n      var ownerRect = owner.getBoundingClientRect();\n      var sceneWidth = ownerRect.width;\n      var sceneHeight = ownerRect.height;\n\n      return {\n        left: sceneWidth * boundsPadding,\n        top: sceneHeight * boundsPadding,\n        right: sceneWidth * (1 - boundsPadding),\n        bottom: sceneHeight * (1 - boundsPadding),\n      }\n    }\n\n    return bounds\n  }\n\n  function getClientRect() {\n    var bbox = domController$$1.getBBox();\n    var leftTop = client(bbox.left, bbox.top);\n\n    return {\n      left: leftTop.x,\n      top: leftTop.y,\n      right: bbox.width * transform$$1.scale + leftTop.x,\n      bottom: bbox.height * transform$$1.scale + leftTop.y\n    }\n  }\n\n  function client(x, y) {\n    return {\n      x: (x * transform$$1.scale) + transform$$1.x,\n      y: (y * transform$$1.scale) + transform$$1.y\n    }\n  }\n\n  function makeDirty() {\n    isDirty = true;\n    frameAnimation = window.requestAnimationFrame(frame);\n  }\n\n  function zoomByRatio(clientX, clientY, ratio) {\n    if (isNaN(clientX) || isNaN(clientY) || isNaN(ratio)) {\n      throw new Error('zoom requires valid numbers')\n    }\n\n    var newScale = transform$$1.scale * ratio;\n\n    if (newScale < minZoom) {\n      if (transform$$1.scale === minZoom) { return; }\n\n      ratio = minZoom / transform$$1.scale;\n    }\n    if (newScale > maxZoom) {\n      if (transform$$1.scale === maxZoom) { return; }\n\n      ratio = maxZoom / transform$$1.scale;\n    }\n\n    var size = transformToScreen(clientX, clientY);\n\n    transform$$1.x = size.x - ratio * (size.x - transform$$1.x);\n    transform$$1.y = size.y - ratio * (size.y - transform$$1.y);\n\n    var transformAdjusted = keepTransformInsideBounds();\n    if (!transformAdjusted) { transform$$1.scale *= ratio; }\n\n    triggerEvent('zoom');\n\n    makeDirty();\n  }\n\n  function zoomAbs(clientX, clientY, zoomLevel) {\n    var ratio = zoomLevel / transform$$1.scale;\n    zoomByRatio(clientX, clientY, ratio);\n  }\n\n  function centerOn(ui) {\n    var parent = ui.ownerSVGElement;\n    if (!parent) { throw new Error('ui element is required to be within the scene') }\n\n    // TODO: should i use controller's screen CTM?\n    var clientRect = ui.getBoundingClientRect();\n    var cx = clientRect.left + clientRect.width/2;\n    var cy = clientRect.top + clientRect.height/2;\n\n    var container = parent.getBoundingClientRect();\n    var dx = container.width/2 - cx;\n    var dy = container.height/2 - cy;\n\n    internalMoveBy(dx, dy, true);\n  }\n\n  function internalMoveBy(dx, dy, smooth) {\n    if (!smooth) {\n      return moveBy(dx, dy)\n    }\n\n    if (moveByAnimation) { moveByAnimation.cancel(); }\n\n    var from = { x: 0, y: 0 };\n    var to = { x: dx, y : dy };\n    var lastX = 0;\n    var lastY = 0;\n\n    moveByAnimation = amator(from, to, {\n      step: function(v) {\n        moveBy(v.x - lastX, v.y - lastY);\n\n        lastX = v.x;\n        lastY = v.y;\n      }\n    });\n  }\n\n  function scroll(x, y) {\n    cancelZoomAnimation();\n    moveTo(x, y);\n  }\n\n  function dispose() {\n    releaseEvents();\n  }\n\n  function listenForEvents() {\n    owner.addEventListener('mousedown', onMouseDown);\n    owner.addEventListener('dblclick', onDoubleClick);\n    owner.addEventListener('touchstart', onTouch);\n    owner.addEventListener('keydown', onKeyDown);\n\n    // Need to listen on the owner container, so that we are not limited\n    // by the size of the scrollable domElement\n    wheel.addWheelListener(owner, onMouseWheel);\n\n    makeDirty();\n  }\n\n  function releaseEvents() {\n    wheel.removeWheelListener(owner, onMouseWheel);\n    owner.removeEventListener('mousedown', onMouseDown);\n    owner.removeEventListener('keydown', onKeyDown);\n    owner.removeEventListener('dblclick', onDoubleClick);\n    owner.removeEventListener('touchstart', onTouch);\n\n    if (frameAnimation) {\n      window.cancelAnimationFrame(frameAnimation);\n      frameAnimation = 0;\n    }\n\n    smoothScroll.cancel();\n\n    releaseDocumentMouse();\n    releaseTouches();\n\n    triggerPanEnd();\n  }\n\n\n  function frame() {\n    if (isDirty) { applyTransform(); }\n  }\n\n  function applyTransform() {\n    isDirty = false;\n\n    // TODO: Should I allow to cancel this?\n    domController$$1.applyTransform(transform$$1);\n\n    triggerEvent('transform');\n    frameAnimation = 0;\n  }\n\n  function onKeyDown(e) {\n    var x = 0, y = 0, z = 0;\n    if (e.keyCode === 38) {\n      y = 1; // up\n    } else if (e.keyCode === 40) {\n      y = -1; // down\n    } else if (e.keyCode === 37) {\n      x = 1; // left\n    } else if (e.keyCode === 39) {\n      x = -1; // right\n    } else if (e.keyCode === 189 || e.keyCode === 109) { // DASH or SUBTRACT\n      z = 1; // `-` -  zoom out\n    } else if (e.keyCode === 187 || e.keyCode === 107) { // EQUAL SIGN or ADD\n      z = -1; // `=` - zoom in (equal sign on US layout is under `+`)\n    }\n\n    if (x || y) {\n      e.preventDefault();\n      e.stopPropagation();\n\n      var clientRect = owner.getBoundingClientRect();\n      // movement speed should be the same in both X and Y direction:\n      var offset = Math.min(clientRect.width, clientRect.height);\n      var moveSpeedRatio = 0.05;\n      var dx = offset * moveSpeedRatio * x;\n      var dy = offset * moveSpeedRatio * y;\n\n      // TODO: currently we do not animate this. It could be better to have animation\n      internalMoveBy(dx, dy);\n    }\n\n    if (z) {\n      var scaleMultiplier = getScaleMultiplier(z);\n      var ownerRect = owner.getBoundingClientRect();\n      publicZoomTo(ownerRect.width/2, ownerRect.height/2, scaleMultiplier);\n    }\n  }\n\n  function onTouch(e) {\n    beforeTouch(e);\n    if (e.touches.length === 1) {\n      return handleSingleFingerTouch(e, e.touches[0])\n    } else if (e.touches.length === 2) {\n      // handleTouchMove() will care about pinch zoom.\n      pinchZoomLength = getPinchZoomLength(e.touches[0], e.touches[1]);\n      multitouch  = true;\n      startTouchListenerIfNeeded();\n    }\n  }\n\n  function beforeTouch(e) {\n    if (options.onTouch && !options.onTouch(e)) {\n      // if they return `false` from onTouch, we don't want to stop\n      // events propagation. Fixes https://github.com/anvaka/panzoom/issues/12\n      return\n    }\n\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  function handleSingleFingerTouch(e) {\n    var touch = e.touches[0];\n    var offset = getOffsetXY(touch);\n    mouseX = offset.x;\n    mouseY = offset.y;\n\n    startTouchListenerIfNeeded();\n  }\n\n  function startTouchListenerIfNeeded() {\n    if (!touchInProgress) {\n      touchInProgress = true;\n      document.addEventListener('touchmove', handleTouchMove);\n      document.addEventListener('touchend', handleTouchEnd);\n      document.addEventListener('touchcancel', handleTouchEnd);\n    }\n  }\n\n  function handleTouchMove(e) {\n    if (e.touches.length === 1) {\n      e.stopPropagation();\n      var touch = e.touches[0];\n\n      var offset = getOffsetXY(touch);\n\n      var dx = offset.x - mouseX;\n      var dy = offset.y - mouseY;\n\n      if (dx !== 0 && dy !== 0) {\n        triggerPanStart();\n      }\n      mouseX = offset.x;\n      mouseY = offset.y;\n      var point = transformToScreen(dx, dy);\n      internalMoveBy(point.x, point.y);\n    } else if (e.touches.length === 2) {\n      // it's a zoom, let's find direction\n      multitouch = true;\n      var t1 = e.touches[0];\n      var t2 = e.touches[1];\n      var currentPinchLength = getPinchZoomLength(t1, t2);\n\n      var scaleMultiplier = 1;\n\n      if (realPinch) {\n        scaleMultiplier = currentPinchLength / pinchZoomLength;\n      } else {\n        var delta = 0;\n        if (currentPinchLength < pinchZoomLength) {\n          delta = 1;\n        } else if (currentPinchLength > pinchZoomLength) {\n          delta = -1;\n        }\n\n        scaleMultiplier = getScaleMultiplier(delta);\n      }\n\n      mouseX = (t1.clientX + t2.clientX)/2;\n      mouseY = (t1.clientY + t2.clientY)/2;\n\n      publicZoomTo(mouseX, mouseY, scaleMultiplier);\n\n      pinchZoomLength = currentPinchLength;\n      e.stopPropagation();\n      e.preventDefault();\n    }\n  }\n\n  function handleTouchEnd(e) {\n    if (e.touches.length > 0) {\n      var offset = getOffsetXY(e.touches[0]);\n      mouseX = offset.x;\n      mouseY = offset.y;\n    } else {\n      var now = new Date();\n      if (now - lastTouchEndTime < doubleTapSpeedInMS) {\n        smoothZoom(mouseX, mouseY, zoomDoubleClickSpeed);\n      }\n\n      lastTouchEndTime = now;\n\n      touchInProgress = false;\n      triggerPanEnd();\n      releaseTouches();\n    }\n  }\n\n  function getPinchZoomLength(finger1, finger2) {\n    return Math.sqrt((finger1.clientX - finger2.clientX) * (finger1.clientX - finger2.clientX) +\n      (finger1.clientY - finger2.clientY) * (finger1.clientY - finger2.clientY))\n  }\n\n  function onDoubleClick(e) {\n    var offset = getOffsetXY(e);\n    smoothZoom(offset.x, offset.y, zoomDoubleClickSpeed);\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  function onMouseDown(e) {\n    if (touchInProgress) {\n      // modern browsers will fire mousedown for touch events too\n      // we do not want this: touch is handled separately.\n      e.stopPropagation();\n      return false\n    }\n    // for IE, left click == 1\n    // for Firefox, left click == 0\n    var isLeftButton = ((e.button === 1 && window.event !== null) || e.button === 0);\n    if (!isLeftButton) { return }\n\n    var offset = getOffsetXY(e);\n    var point = transformToScreen(offset.x, offset.y);\n    mouseX = point.x;\n    mouseY = point.y;\n\n    // We need to listen on document itself, since mouse can go outside of the\n    // window, and we will loose it\n    document.addEventListener('mousemove', onMouseMove);\n    document.addEventListener('mouseup', onMouseUp);\n\n    preventTextSelection.capture(e.target || e.srcElement);\n\n    return false\n  }\n\n  function onMouseMove(e) {\n    // no need to worry about mouse events when touch is happening\n    if (touchInProgress) { return }\n\n    triggerPanStart();\n\n    var offset = getOffsetXY(e);\n    var point = transformToScreen(offset.x, offset.y);\n    var dx = point.x - mouseX;\n    var dy = point.y - mouseY;\n\n    mouseX = point.x;\n    mouseY = point.y;\n\n    internalMoveBy(dx, dy);\n  }\n\n  function onMouseUp() {\n    preventTextSelection.release();\n    triggerPanEnd();\n    releaseDocumentMouse();\n  }\n\n  function releaseDocumentMouse() {\n    document.removeEventListener('mousemove', onMouseMove);\n    document.removeEventListener('mouseup', onMouseUp);\n    panstartFired = false;\n  }\n\n  function releaseTouches() {\n    document.removeEventListener('touchmove', handleTouchMove);\n    document.removeEventListener('touchend', handleTouchEnd);\n    document.removeEventListener('touchcancel', handleTouchEnd);\n    panstartFired = false;\n    multitouch = false;\n  }\n\n  function onMouseWheel(e) {\n    // if client does not want to handle this event - just ignore the call\n    if (beforeWheel(e)) { return }\n\n    smoothScroll.cancel();\n\n    var scaleMultiplier = getScaleMultiplier(e.deltaY);\n\n    if (scaleMultiplier !== 1) {\n      var offset = getOffsetXY(e);\n      publicZoomTo(offset.x, offset.y, scaleMultiplier);\n      e.preventDefault();\n    }\n  }\n\n  function getOffsetXY(e) {\n    var offsetX, offsetY;\n    // I tried using e.offsetX, but that gives wrong results for svg, when user clicks on a path.\n    var ownerRect = owner.getBoundingClientRect();\n    offsetX = e.clientX - ownerRect.left;\n    offsetY = e.clientY - ownerRect.top;\n\n    return {x: offsetX, y: offsetY};\n  }\n\n  function smoothZoom(clientX, clientY, scaleMultiplier) {\n      var fromValue = transform$$1.scale;\n      var from = {scale: fromValue};\n      var to = {scale: scaleMultiplier * fromValue};\n\n      smoothScroll.cancel();\n      cancelZoomAnimation();\n\n      // TODO: should consolidate this and publicZoomTo\n      triggerEvent('zoom');\n\n      zoomToAnimation = amator(from, to, {\n        step: function(v) {\n          zoomAbs(clientX, clientY, v.scale);\n        }\n      });\n  }\n\n  function publicZoomTo(clientX, clientY, scaleMultiplier) {\n      smoothScroll.cancel();\n      cancelZoomAnimation();\n      return zoomByRatio(clientX, clientY, scaleMultiplier)\n  }\n\n  function cancelZoomAnimation() {\n      if (zoomToAnimation) {\n          zoomToAnimation.cancel();\n          zoomToAnimation = null;\n      }\n  }\n\n  function getScaleMultiplier(delta) {\n    var scaleMultiplier = 1;\n    if (delta > 0) { // zoom out\n      scaleMultiplier = (1 - speed);\n    } else if (delta < 0) { // zoom in\n      scaleMultiplier = (1 + speed);\n    }\n\n    return scaleMultiplier\n  }\n\n  function triggerPanStart() {\n    if (!panstartFired) {\n      triggerEvent('panstart');\n      panstartFired = true;\n      smoothScroll.start();\n    }\n  }\n\n  function triggerPanEnd() {\n    if (panstartFired) {\n      // we should never run smooth scrolling if it was multitouch (pinch zoom animation):\n      if (!multitouch) { smoothScroll.stop(); }\n      triggerEvent('panend');\n    }\n  }\n\n  function triggerEvent(name) {\n    var event = createEvent_1(name);\n    domElement.dispatchEvent(event);\n  }\n}\n\nfunction noop() { }\n\nfunction validateBounds(bounds) {\n  var boundsType = typeof bounds;\n  if (boundsType === 'undefined' || boundsType === 'boolean') { return } // this is okay\n  // otherwise need to be more thorough:\n  var validBounds = isNumber(bounds.left) && isNumber(bounds.top) &&\n    isNumber(bounds.bottom) && isNumber(bounds.right);\n\n  if (!validBounds) { throw new Error('Bounds object is not valid. It can be: ' +\n    'undefined, boolean (true|false) or an object {left, top, right, bottom}') }\n}\n\nfunction isNumber(x) {\n  return Number.isFinite(x)\n}\n\n// IE 11 does not support isNaN:\nfunction isNaN(value) {\n  if (Number.isNaN) {\n    return Number.isNaN(value)\n  }\n\n  return value !== value\n}\n\nfunction rigidScroll() {\n  return {\n    start: noop,\n    stop: noop,\n    cancel: noop\n  }\n}\n\n\nfunction autoRun() {\n  if (typeof document === 'undefined') { return }\n\n  var scripts = document.getElementsByTagName('script');\n  if (!scripts) { return; }\n  var panzoomScript;\n\n  Array.from(scripts).forEach(function(x) {\n    if (x.src && x.src.match(/\\bpanzoom(\\.min)?\\.js/)) {\n      panzoomScript = x;\n    }\n  });\n\n  if (!panzoomScript) { return; }\n\n  var query = panzoomScript.getAttribute('query');\n  if (!query) { return; }\n\n  var globalName = panzoomScript.getAttribute('name') || 'pz';\n  var started = Date.now();\n\n  tryAttach();\n\n  function tryAttach() {\n    var el = document.querySelector(query);\n    if (!el) {\n      var now = Date.now();\n      var elapsed = now - started;\n      if (elapsed < 2000) {\n        // Let's wait a bit\n        setTimeout(tryAttach, 100);\n        return;\n      }\n      // If we don't attach within 2 seconds to the target element, consider it a failure\n      console.error('Cannot find the panzoom element', globalName);\n      return\n    }\n    var options = collectOptions(panzoomScript);\n    console.log(options);\n    window[globalName] = createPanZoom(el, options);\n  }\n\n  function collectOptions(script) {\n    var attrs = script.attributes;\n    var options = {};\n    for(var i = 0; i < attrs.length; ++i) {\n      var attr = attrs[i];\n      var nameValue = getPanzoomAttributeNameValue(attr);\n      if (nameValue) {\n        options[nameValue.name] = nameValue.value;\n      }\n    }\n\n    return options;\n  }\n\n  function getPanzoomAttributeNameValue(attr) {\n    if (!attr.name) { return; }\n    var isPanZoomAttribute = attr.name[0] === 'p' && attr.name[1] === 'z' && attr.name[2] === '-';\n\n    if (!isPanZoomAttribute) { return; }\n\n    var name = attr.name.substr(3);\n    var value = JSON.parse(attr.value);\n    return {name: name, value: value};\n  }\n}\n\nautoRun();\n\nvar ngraph_events$1 = function(subject) {\n  validateSubject(subject);\n\n  var eventsStorage = createEventsStorage(subject);\n  subject.on = eventsStorage.on;\n  subject.off = eventsStorage.off;\n  subject.fire = eventsStorage.fire;\n  return subject;\n};\n\nfunction createEventsStorage(subject) {\n  // Store all event listeners to this hash. Key is event name, value is array\n  // of callback records.\n  //\n  // A callback record consists of callback function and its optional context:\n  // { 'eventName' => [{callback: function, ctx: object}] }\n  var registeredEvents = Object.create(null);\n\n  return {\n    on: function (eventName, callback, ctx) {\n      if (typeof callback !== 'function') {\n        throw new Error('callback is expected to be a function');\n      }\n      var handlers = registeredEvents[eventName];\n      if (!handlers) {\n        handlers = registeredEvents[eventName] = [];\n      }\n      handlers.push({callback: callback, ctx: ctx});\n\n      return subject;\n    },\n\n    off: function (eventName, callback) {\n      var wantToRemoveAll = (typeof eventName === 'undefined');\n      if (wantToRemoveAll) {\n        // Killing old events storage should be enough in this case:\n        registeredEvents = Object.create(null);\n        return subject;\n      }\n\n      if (registeredEvents[eventName]) {\n        var deleteAllCallbacksForEvent = (typeof callback !== 'function');\n        if (deleteAllCallbacksForEvent) {\n          delete registeredEvents[eventName];\n        } else {\n          var callbacks = registeredEvents[eventName];\n          for (var i = 0; i < callbacks.length; ++i) {\n            if (callbacks[i].callback === callback) {\n              callbacks.splice(i, 1);\n            }\n          }\n        }\n      }\n\n      return subject;\n    },\n\n    fire: function (eventName) {\n      var callbacks = registeredEvents[eventName];\n      if (!callbacks) {\n        return subject;\n      }\n\n      var fireArguments;\n      if (arguments.length > 1) {\n        fireArguments = Array.prototype.splice.call(arguments, 1);\n      }\n      for(var i = 0; i < callbacks.length; ++i) {\n        var callbackInfo = callbacks[i];\n        callbackInfo.callback.apply(callbackInfo.ctx, fireArguments);\n      }\n\n      return subject;\n    }\n  };\n}\n\nfunction validateSubject(subject) {\n  if (!subject) {\n    throw new Error('Eventify cannot use falsy object as events subject');\n  }\n  var reservedWords = ['on', 'fire', 'off'];\n  for (var i = 0; i < reservedWords.length; ++i) {\n    if (subject.hasOwnProperty(reservedWords[i])) {\n      throw new Error(\"Subject cannot be eventified, since it already has property '\" + reservedWords[i] + \"'\");\n    }\n  }\n}\n\nvar Transform$2 = function Transform(scale, dx, dy) {\n  scale = scale || 1;\n  dx = dx || 0;\n  dy = dy || 0;\n  this._array = [\n    scale, 0,0, 0,\n    0, scale,0, 0,\n    0, 0,1, 0,\n    dx, dy,0, 1\n  ];\n};\n\nvar prototypeAccessors = { scale: {},dx: {},dy: {} };\n\nTransform$2.prototype.multiply = function multiply (a, b) {\n  var scale = a.scale * b.scale;\n  var dx = a.scale * b.dx + a.dx;\n  var dy = a.scale * b.dy + a.dy;\n\n  this.scale = scale;\n  this.dx = dx;\n  this.dy = dy;\n\n  return this;\n};\n\nprototypeAccessors.scale.get = function () {\n  return this._array[0];\n};\n\nprototypeAccessors.dx.get = function () {\n  return this._array[12];\n};\n\nprototypeAccessors.dy.get = function () {\n  return this._array[13];\n};\n\nprototypeAccessors.dx.set = function (newDx) {\n  this._array[12] = newDx;\n};\n  \nprototypeAccessors.dy.set = function (newDy) {\n  this._array[13] = newDy;\n};\n\nprototypeAccessors.scale.set = function (newScale) {\n  this._array[0] = newScale;\n  this._array[5] = newScale;\n};\n\nTransform$2.prototype.copyTo = function copyTo (dst) {\n  copyArray(this._array, dst._array);\n  return this;\n};\n\nTransform$2.prototype.getArray = function getArray () {\n  return this._array;\n};\n\nObject.defineProperties( Transform$2.prototype, prototypeAccessors );\n\nfunction copyArray(from, to) {\n  if (from.length !== to.length) {\n    throw new Error('Array length mismatch');\n  }\n\n  for(var i = 0; i < from.length; ++i) {\n    to[i] = from[i];\n  }\n}\n\n/**\n * represents a single element in the scene tree\n */\nvar Element = function Element() {\n  this.children = [];\n  this.transform = new Transform$2();\n\n  // Stores transformation to the \"world\" coordinates. If this element has\n  // no parent, this object is equal to `this.transform`\n  this.worldTransform = new Transform$2();\n  this.worldTransformNeedsUpdate = true;\n  this.type = 'Element';\n  this.scene = null;\n};\n\nElement.prototype.appendChild = function appendChild (child, sendToBack) {\n  child.parent = this;\n  if (sendToBack) {\n    // back of z-index\n    this.children.unshift(child);\n  } else {\n    this.children.push(child);\n  }\n  if (child.bindScene) {\n    child.bindScene(this.scene);\n  }\n\n  if (this.scene) { this.scene.renderFrame(); }\n};\n\nElement.prototype.bindScene = function bindScene (scene) {\n  this.scene = scene;\n};\n\nElement.prototype.traverse = function traverse (enterCallback, exitCallback) {\n    var this$1 = this;\n\n  enterCallback(this);\n\n  for (var i = 0; i < this.children.length; ++i) {\n    var child = this$1.children[i];\n    child.traverse(enterCallback, exitCallback);\n  }\n\n  if (exitCallback) { exitCallback(this); }\n};\n\nElement.prototype.removeChild = function removeChild (child) {\n  // TODO: should this be faster?\n  var childIdx = this.children.indexOf(child);\n  if (childIdx > -1) {\n    this.children.splice(childIdx, 1);\n  }\n\n  if (this.scene) { this.scene.renderFrame(); }\n};\n\nElement.prototype.updateWorldTransform = function updateWorldTransform (force) {\n  if (this.worldTransformNeedsUpdate || force) {\n    if (!this.parent) {\n      this.transform.copyTo(this.worldTransform);\n    } else {\n      this.worldTransform.multiply(this.parent.worldTransform, this.transform);\n    }\n\n    this.worldTransformNeedsUpdate = false;\n    force = true; // We have to update children now.\n  }\n\n  var wasDirty = force;\n\n  var children = this.children;\n  for (var i = 0; i < children.length; i++ ) {\n     wasDirty = children[i].updateWorldTransform(force) || wasDirty;\n  }\n\n  return wasDirty;\n};\n\nElement.prototype.draw = function draw (gl, screen) {\n    var this$1 = this;\n\n  for (var i = 0; i < this.children.length; ++i) {\n    var child = this$1.children[i];\n    child.draw(gl, screen);\n  }\n};\n\nElement.prototype.dispose = function dispose () {\n    var this$1 = this;\n\n  for (var i = 0; i < this.children.length; ++i) {\n    var child = this$1.children[i];\n    child.dispose();\n  }\n};\n\nvar config = {\n  maxSingleTouchTime: 300, // ms\n  singleTapDistanceSquared: 25 // within 5px we consider it as a single tap\n};\n\nfunction onClap$1(element, callback, ctx) {\n  var touchStartTime = new Date();\n  var startPos;\n\n  element.addEventListener('click', invokeHandler);\n\n  element.addEventListener('touchend', handleTouchEnd);\n  element.addEventListener('touchstart', handleTouchStart);\n\n  return disposePrevHandler;\n\n  function handleTouchStart(e) {\n    var touches = e.touches;\n\n    if (touches.length === 1) {\n      touchStartTime = new Date();\n      startPos = {\n        x: e.touches[0].pageX,\n        y: e.touches[0].pageY\n      };\n    }\n  }\n\n  function handleTouchEnd(e) {\n    // multitouch - ignore\n    if (e.touches.length > 1) { return }\n\n    // single touch - use time difference to determine if it was a touch or\n    // a swipe\n    var dt = new Date() - touchStartTime;\n\n    // To long - ignore\n    if (dt > config.maxSingleTouchTime) { return }\n    var touch = e.changedTouches[0];\n\n    var dx = touch.pageX - startPos.x;\n    var dy = touch.pageY - startPos.y;\n\n    if (dx * dx + dy * dy < config.singleTapDistanceSquared) {\n      invokeHandler(touch);\n    }\n  }\n\n  function disposePrevHandler() {\n    element.removeEventListener('click', invokeHandler);\n    element.removeEventListener('touchend', handleTouchEnd);\n    element.removeEventListener('touchstart', handleTouchStart);\n  }\n\n  function invokeHandler(e) {\n    callback.call(ctx, e);\n  }\n}\n\nfunction makeScene$1(canvas, options) {\n  var width;\n  var height;\n  var drawContext = { width: 0, height: 0 };\n  var pixelRatio = window.devicePixelRatio;\n  if (!options) { options = {}; }\n\n  var wglContextOptions = options.wglContext;\n\n  var gl = canvas.getContext('webgl', wglContextOptions) || canvas.getContext('experimental-webgl', wglContextOptions);\n\n  gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\n  gl.enable(gl.BLEND);\n  gl.clearColor(0, 0, 0, 1.0);\n  gl.clear(gl.COLOR_BUFFER_BIT);\n\n  var frameToken = 0;\n  var sceneRoot = new Element();\n  updateCanvasSize();\n\n  var api = ngraph_events$1({\n    appendChild: appendChild,\n    getSceneCoordinate: getSceneCoordinate,\n    getClientCoordinate: getClientCoordinate,\n    getTransform: getTransform,\n    getRoot: getRoot,\n    removeChild: removeChild,\n    setViewBox: setViewBox,\n    setClearColor: setClearColor,\n    dispose: dispose,\n    renderFrame: renderFrame,\n\n    getPixelRatio: getPixelRatio,\n    setPixelRatio: setPixelRatio\n  });\n\n  var wglController = wglPanZoom(canvas, sceneRoot, api);\n\n  var panzoom$$1 = panzoom(canvas, {\n    zoomSpeed: 0.025,\n    controller: wglController \n  });\n\n  sceneRoot.bindScene(api);\n\n  var disposeClick;\n  listenToEvents();\n\n  renderFrame();\n\n  return api;\n\n  function getPixelRatio() {\n    return pixelRatio;\n  }\n\n  function setPixelRatio(newPixelRatio) {\n    pixelRatio = newPixelRatio;\n    updateCanvasSize();\n  }\n\n  function getRoot() {\n    return sceneRoot;\n  }\n\n  function getTransform() {\n    return sceneRoot.transform;\n  }\n\n  function setClearColor(r, g, b, a) {\n    gl.clearColor(r, g, b, a);\n  }\n\n  function listenToEvents() {\n    canvas.addEventListener('mousemove', onMouseMove);\n    canvas.addEventListener('transform', onTransform);\n\n    disposeClick = onClap$1(canvas, onMouseClick, this);\n\n    window.addEventListener('resize', onResize, true);\n  }\n\n  function dispose() {\n    canvas.removeEventListener('mousemove', onMouseMove);\n    canvas.removeEventListener('transform', onTransform);\n    if (disposeClick) { disposeClick(); }\n\n    window.removeEventListener('resize', onResize, true);\n\n    panzoom$$1.dispose();\n    sceneRoot.dispose();\n\n    if (frameToken) {\n      cancelAnimationFrame(frameToken);\n      frameToken = 0;\n    }\n  }\n\n  function onResize() {\n    updateCanvasSize();\n  }\n\n  function updateCanvasSize() {\n    if (options.size) {\n      // Fixed size canvas doesn't update. We assume CSS does the scaling.\n      width = canvas.width = options.size.width;\n      height = canvas.height = options.size.height;\n    } else {\n      width = canvas.width = canvas.offsetWidth * pixelRatio;\n      height = canvas.height = canvas.offsetHeight * pixelRatio;\n    }\n\n    gl.viewport(0, 0, width, height);\n\n    drawContext.width = width;\n    drawContext.height = height;\n    sceneRoot.worldTransformNeedsUpdate = true;\n    renderFrame();\n  }\n\n  function onTransform(e) {\n    api.fire('transform', e);\n  }\n\n  function onMouseClick(e) {\n    var p = getSceneCoordinate(e.clientX, e.clientY);\n    api.fire('click', {\n      originalEvent: e,\n      sceneX: p.x,\n      sceneY: p.y,\n    });\n  }\n\n  function onMouseMove(e) {\n    var p = getSceneCoordinate(e.clientX, e.clientY);\n    api.fire('mousemove', {\n      originalEvent: e,\n      sceneX: p.x,\n      sceneY: p.y,\n    });\n  }\n\n  function getSceneCoordinate(clientX, clientY) {\n    var t = sceneRoot.transform;\n    var canvasX = clientX * pixelRatio;\n    var canvasY = clientY * pixelRatio;\n    var x = (canvasX - t.dx)/t.scale;\n    var y = (canvasY - t.dy)/t.scale;\n\n    return {x: x, y: y};\n  }\n\n  function getClientCoordinate(sceneX, sceneY) {\n    var t = sceneRoot.transform;\n\n    var x = (sceneX * t.scale + t.dx)/pixelRatio;\n    var y = (sceneY * t.scale + t.dy)/pixelRatio;\n\n    return {x: x, y: y};\n  }\n\n  function setViewBox(rect) {\n    panzoom$$1.showRectangle(rect, {\n      width: width,\n      height: height\n    });\n    var newT = panzoom$$1.getTransform();\n    wglController.applyTransform(newT);\n  }\n\n  function renderFrame() {\n    if (!frameToken) { frameToken = requestAnimationFrame(frame); }\n  }\n\n  function frame() {\n    gl.clear(gl.COLOR_BUFFER_BIT);\n    drawContext.wasDirty = sceneRoot.updateWorldTransform();\n    sceneRoot.draw(gl, drawContext);\n    frameToken = 0;\n  }\n\n  function appendChild(child, sendToBack) {\n    sceneRoot.appendChild(child, sendToBack);\n  }\n\n  function removeChild(child) {\n    sceneRoot.removeChild(child);\n  }\n\n  function wglPanZoom(canvas, sceneRoot, scene) {\n    var controller = {\n      applyTransform: function applyTransform(newT) {\n        var transform = sceneRoot.transform;\n        var pixelRatio = scene.getPixelRatio();\n\n        transform.dx = newT.x * pixelRatio;\n        transform.dy = newT.y * pixelRatio;\n        transform.scale = newT.scale;\n        sceneRoot.worldTransformNeedsUpdate = true;\n        scene.renderFrame();\n      },\n\n      getOwner: function getOwner() {\n        return canvas\n      }\n    };\n\n    if (options.size){\n      controller.getScreenCTM = customSizeCTM;\n    }\n\n    return controller;\n\n    function customSizeCTM() {\n        return {\n          a: (options.size.width/canvas.offsetWidth), //scale x\n          d: (options.size.height/canvas.offsetHeight), //scale y\n          e: 0,\n          f: 0\n        }\n      }\n  }\n}\n\nvar glUtils = {\n  compile: compile,\n  link: link,\n  getLocations: getLocations,\n  getAttributes: getAttributes,\n  getUniforms: getUniforms,\n  initBuffer: initBuffer\n};\n\nfunction compile(gl, type, shaderSrc) {\n  var shader = gl.createShader(type);\n  gl.shaderSource(shader, shaderSrc);\n  gl.compileShader(shader);\n\n  if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n    throw new Error(gl.getShaderInfoLog(shader));\n  }\n\n  return shader;\n}\n\nfunction link(gl, vertexShader, fragmentShader) {\n  var program = gl.createProgram();\n  gl.attachShader(program, vertexShader);\n  gl.attachShader(program, fragmentShader);\n\n  gl.linkProgram(program);\n\n  if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {\n    throw new Error(gl.getProgramInfoLog(program));\n  }\n\n  return program;\n}\n\nfunction getLocations(gl, program) {\n  return {\n    attributes: getAttributes(gl, program),\n    uniforms: getUniforms(gl, program)\n  }\n}\n\nfunction getAttributes(gl, program) {\n  var attributes = Object.create(null);\n\n  var numberOfAttributes = gl.getProgramParameter(program, gl.ACTIVE_ATTRIBUTES);\n  for (var i = 0; i < numberOfAttributes; ++i) {\n    var name = gl.getActiveAttrib(program, i).name;\n    attributes[name] = gl.getAttribLocation(program, name);\n  }\n\n  return attributes;\n}\n\nfunction getUniforms(gl, program) {\n  var uniforms = Object.create(null);\n  var numberOfUniforms = gl.getProgramParameter(program, gl.ACTIVE_UNIFORMS);\n  for (var i = 0; i < numberOfUniforms; ++i) {\n    var name = gl.getActiveUniform(program, i).name;\n    uniforms[name] = gl.getUniformLocation(program, name);\n  }\n\n  return uniforms;\n}\n\nfunction initBuffer(gl, data, elementsPerVertex, attribute) {\n  var buffer = gl.createBuffer();\n  if (!buffer) { throw new Error('Failed to create a buffer'); }\n\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\n  gl.vertexAttribPointer(attribute, elementsPerVertex, gl.FLOAT, false, 0, 0);\n  gl.enableVertexAttribArray(attribute);\n}\n\nvar shaderGraph = {\n  /**\n   * Gets vertex shader code from a given array of shader graph nodes.\n   */\n  getVSCode: getVSCode\n};\n\nfunction getVSCode(nodes) {\n  // We just generate shader code in multiple passes.\n  var code = []; \n  nodes.forEach(function (node) {\n    if (node.globals) { code.push(node.globals()); }\n  });\n  code.push('void main() {');\n  nodes.forEach(function (node) {\n    if (node.mainBody) { code.push(node.mainBody()); }\n  });\n  code.push('}');\n\n  return code.join('\\n');\n}\n\nvar panzoomVS = {\n  globals: function globals() {\n    return \"\\nattribute vec2 aPosition;\\nuniform vec2 uScreenSize;\\nuniform mat4 uTransform;\\n\";\n  },\n  mainBody: function mainBody() {\n    return \"\\n  mat4 transformed = mat4(uTransform);\\n\\n  // Translate screen coordinates to webgl space\\n  vec2 vv = 2.0 * uTransform[3].xy/uScreenSize;\\n  transformed[3][0] = vv.x - 1.0;\\n  transformed[3][1] = 1.0 - vv.y;\\n  vec2 xy = 2.0 * aPosition/uScreenSize;\\n  gl_Position = transformed * vec4(xy.x, -xy.y, 0.0, 1.0);\\n\"\n  }\n};\n\nvar pointVS = {\n  globals: function globals() {\n    return \"\\nattribute float aPointSize;\\nattribute vec4 aColor;\\nvarying vec4 vColor;\\n\";\n  },\n  mainBody: function mainBody() {\n    return \"\\n  gl_PointSize = aPointSize * transformed[0][0];\\n  vColor = aColor;\\n\";\n  }\n};\n\nvar vertexShaderSrc = shaderGraph.getVSCode([\n  panzoomVS,\n  pointVS\n]);\n\nvar fragmentShaderSrc = \"\\nprecision highp float;\\nvarying vec4 vColor;\\nuniform sampler2D texture;\\n\\nvoid main() {\\n  vec4 tColor = texture2D( texture, gl_PointCoord );\\n  gl_FragColor = vec4(vColor.rgb, tColor.a);\\n  //gl_FragColor = vec4(vColor.rgb, 1.0);\\n  // vec2 t = 2.0 * gl_PointCoord - 1.0;\\n  // float a = 1.0 - pow(t.x, 2.0) - pow(t.y, 2.0);\\n  // gl_FragColor = vec4(vColor.rgb, a);\\n}\\n\";\n\nvar vertexProgramCache = new Map(); // maps from GL context to program\n\nfunction makePointsProgram$1(gl, data) {\n  var vertexProgram = vertexProgramCache.get(gl);\n  if (!vertexProgram) {\n    var vertexShader = glUtils.compile(gl, gl.VERTEX_SHADER, vertexShaderSrc);\n    var fragmentShader = glUtils.compile(gl, gl.FRAGMENT_SHADER, fragmentShaderSrc);\n    vertexProgram = glUtils.link(gl, vertexShader, fragmentShader);\n    vertexProgramCache.set(gl, vertexProgram);\n  }\n\n  var locations = glUtils.getLocations(gl, vertexProgram);\n\n  var buffer = gl.createBuffer();\n  if (!buffer) { throw new Error('failed to create a nodesBuffer'); }\n  gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n  gl.bufferData(gl.ARRAY_BUFFER, data.byteLength, gl.DYNAMIC_DRAW);\n\n  var pointTexture = createCircleTexture(gl);\n\n  var api = {\n    draw: draw,\n    updateData: updateData,\n    dispose: dispose\n  };\n  return api;\n\n  function updateData(newData) {\n    data = newData;\n  }\n\n  function dispose() {\n    // For some reason disposing the buffer results in unbindable\n    // buffer for the lines program (that is created after this scene is disposed).\n    // gl.deleteBuffer(buffer);\n    gl.deleteProgram(vertexProgram);\n    gl.deleteTexture(pointTexture);\n    vertexProgramCache.delete(gl);\n  }\n\n  function draw(transform, screen, count) {\n    gl.useProgram(vertexProgram);\n\n    var bpe = data.BYTES_PER_ELEMENT;\n\n    if (transform) {\n      gl.uniformMatrix4fv(locations.uniforms.uTransform, false, transform.getArray());\n    }\n    gl.uniform2f(locations.uniforms.uScreenSize, screen.width, screen.height);\n    gl.bindTexture(gl.TEXTURE_2D, pointTexture);\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, buffer);\n    gl.bufferData(gl.ARRAY_BUFFER, data, gl.DYNAMIC_DRAW);\n\n    gl.vertexAttribPointer(locations.attributes.aPosition, 2, gl.FLOAT, false, bpe * 6, 0);\n    gl.enableVertexAttribArray(locations.attributes.aPosition);\n\n    gl.vertexAttribPointer(locations.attributes.aPointSize, 1, gl.FLOAT, false, bpe * 6, 2 * bpe);\n    gl.enableVertexAttribArray(locations.attributes.aPointSize);\n\n    gl.vertexAttribPointer(locations.attributes.aColor, 3, gl.FLOAT, false, bpe * 6, 3 * bpe);\n    gl.enableVertexAttribArray(locations.attributes.aColor);\n    gl.drawArrays(gl.POINTS, 0, count);\n  }\n}\n\nfunction createCircleTexture(gl) {\n  var pointTexture = gl.createTexture();\n  if (!pointTexture) { throw new Error('Failed to create circle texture'); }\n  gl.bindTexture(gl.TEXTURE_2D, pointTexture);\n\n  var size = 64;\n  var image = circle(size);\n\n  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, size, size, 0, gl.RGBA, gl.UNSIGNED_BYTE, image);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);\n  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);\n  gl.generateMipmap(gl.TEXTURE_2D);\n\n  return pointTexture;\n\n  function circle(size) {\n    var result = new Uint8Array(size * size * 4);\n    var r = (size - 8)/2;\n    for (var row = 0; row < size; ++row) {\n      var offset = row * size;\n      for (var col = 0; col < size; ++col) {\n        var rgbaCoord = (offset + col) * 4;\n        var cy = row - r;\n        var cx = col - r;\n        var distToCenter = Math.sqrt(cx * cx + cy * cy);\n        if (distToCenter < r) {\n          var ratio = (1 - distToCenter/r);\n          result[rgbaCoord + 3] = ratio > 0.3 ? 0xff : 0xff * ratio;\n        } else {\n          result[rgbaCoord + 3] = 0x00;\n        }\n      }\n    }\n    return blur(result, size)\n\n    //return result\n  }\n}\n\nfunction blur(src, size) {\n  var result = new Uint8Array(size * size * 4);\n  for (var row = 0; row < size; ++row) {\n    for (var col = 0; col < size; ++col) {\n      result[(row * size + col) * 4 + 3] = sample(row, col, 3, src, size);\n    }\n  }\n\n  return result;\n\n}\nfunction sample(row, col, depth, src, size) {\n  var avg = 0;\n  var count = 0;\n  for (var y = row - depth; y < row + depth; ++y) {\n    if (y < 0 || y >= size) { continue; }\n    for (var x = col - depth; x < col + depth; ++x) {\n      if (x < 0 || x >= size) { continue; }\n\n      avg += src[(y * size + x) * 4 + 3];\n      count += 1;\n    }\n  }\n\n  return avg/count;\n}\n\nvar Color = function Color(r, g, b, a) {\n  this.r = r;\n  this.g = g;\n  this.b = b;\n  this.a = a === undefined ? 1 : a;\n};\n\nvar PointAccessor = function PointAccessor(buffer, offset, color, data) {\n  this.offset = offset;\n  this.buffer = buffer;\n  this.color = color || new Color(1, 1, 1, 1); \n  if (data !== undefined) {\n    this.data = data;\n  }\n};\n\nvar prototypeAccessors$1 = { x: {},y: {} };\n\nprototypeAccessors$1.x.get = function () {\n  return this.buffer[this.offset];\n};\n\nprototypeAccessors$1.y.get = function () {\n  return this.buffer[this.offset + 1];\n};\n\nPointAccessor.prototype.update = function update (point, defaults) {\n  var offset = this.offset;\n  var points = this.buffer;\n\n  points[offset + 0] = point.x;\n  points[offset + 1] = point.y;\n  if (point.size || defaults) {\n    points[offset + 2] = typeof point.size === 'number' ? point.size : defaults.size;\n  }\n\n  this.setColor(this.color);\n};\n\nPointAccessor.prototype.setColor = function setColor (color) {\n  this.color = color;\n  // TODO: This is waste, we can store rgba in 32 bits, not in the 3 * 3 * 8 bits?\n  this.buffer[this.offset + 3] = color.r;\n  this.buffer[this.offset + 4] = color.g;\n  this.buffer[this.offset + 5] = color.b;\n};\n\nObject.defineProperties( PointAccessor.prototype, prototypeAccessors$1 );\n\nvar ITEMS_PER_POINT = 6;  // x, y, size, r, g, b\n\nvar PointCollection = (function (Element$$1) {\n  function PointCollection(capacity) {\n    Element$$1.call(this);\n    this.type = 'PointCollection';\n\n    // TODO: Not sure I like this too much. But otherwise how can I track interactivity?\n    this.pointsAccessor = [];\n\n    this.capacity = capacity;\n    this.pointsBuffer = new Float32Array(capacity * ITEMS_PER_POINT);\n    this.count = 0;\n    this._program = null;\n    this.color = new Color(1, 1, 1, 1);\n    this.size = 1;\n  }\n\n  if ( Element$$1 ) PointCollection.__proto__ = Element$$1;\n  PointCollection.prototype = Object.create( Element$$1 && Element$$1.prototype );\n  PointCollection.prototype.constructor = PointCollection;\n\n  PointCollection.prototype.draw = function draw (gl, screen) {\n    if (!this._program) {\n      this._program = makePointsProgram$1(gl, this.pointsBuffer);\n    }\n\n    this._program.draw(this.worldTransform, screen, this.count);\n  };\n\n  PointCollection.prototype.dispose = function dispose () {\n    if (this._program) {\n      this._program.dispose();\n      this._program = null;\n    }\n  };\n\n  PointCollection.prototype.add = function add (point, data) {\n    if (!point) { throw new Error('Point is required'); }\n\n    if (this.count >= this.capacity)  {\n      this._extendArray();\n    }\n    var pointsBuffer = this.pointsBuffer;\n    var internalNodeId = this.count;\n    var offset = internalNodeId * ITEMS_PER_POINT;\n    var pointAccessor = new PointAccessor(pointsBuffer, offset, point.color || this.color, data);\n\n    this.pointsAccessor.push(pointAccessor);\n\n    pointAccessor.update(point, this);\n\n    this.count += 1;\n    return pointAccessor\n  };\n\n  PointCollection.prototype._extendArray = function _extendArray () {\n    // This is because we would have to track every created point accessor\n    // TODO: Whelp, a week older you thinks that we should be tracking the points\n    // for interactivity... So, might as well implement this stuff. Remember anything\n    // about premature optimization?\n    throw new Error('Cannot extend array at the moment :(')\n  };\n\n  return PointCollection;\n}(Element));\n\nvar Point = function Point(x, y, size) {\n  if (Number.isNaN(x)) { throw new Error('x is not a number'); }\n  if (Number.isNaN(y)) { throw new Error('y is not a number'); }\n\n  this.x = x;\n  this.y = y;\n  this.color = new Color(255, 255, 255);\n\n  this.size = Number.isFinite(size) ? size : 4;\n};\n\nvar BaseLineCollection = (function (Element$$1) {\n  function BaseLineCollection(capacity, itemsPerLine) {\n    Element$$1.call(this);\n\n    this.itemsPerLine = itemsPerLine;\n    this.capacity = capacity;\n    this.count = 0;\n    this._program = null;\n    this.color = new Color(1, 1, 1, 1);\n    this.buffer = new Float32Array(capacity * this.itemsPerLine);\n  }\n\n  if ( Element$$1 ) BaseLineCollection.__proto__ = Element$$1;\n  BaseLineCollection.prototype = Object.create( Element$$1 && Element$$1.prototype );\n  BaseLineCollection.prototype.constructor = BaseLineCollection;\n\n  BaseLineCollection.prototype.draw = function draw (gl, screen) {\n    if (!this._program) {\n      this._program = this._makeProgram(gl);\n    }\n    var transform = this.worldTransform;\n\n    this._program.draw(transform, this.color, screen);\n  };\n\n  BaseLineCollection.prototype._makeProgram = function _makeProgram () {\n    throw new Error('Not implemented');\n  };\n\n  BaseLineCollection.prototype._addInternal = function _addInternal () {\n    throw new Error('Not implemented');\n  };\n\n  BaseLineCollection.prototype.add = function add (line) {\n    if (!line) { throw new Error('Line is required'); }\n\n    if (this.count >= this.capacity)  {\n      this._extendArray();\n    }\n\n    var offset = this.count * this.itemsPerLine;\n    var ui = this._addInternal(line, offset);\n\n    this.count += 1;\n    return ui;\n  };\n\n  BaseLineCollection.prototype.dispose = function dispose () {\n    if (this._program) {\n      this._program.dispose();\n      this._program = null;\n    }\n  };\n\n  BaseLineCollection.prototype._extendArray = function _extendArray () {\n    // Every time we run out of space create new array twice bigger.\n    var newCapacity = this.capacity * this.itemsPerLine * 2;\n    var extendedArray = new Float32Array(newCapacity);\n    if (this.buffer) {\n      extendedArray.set(this.buffer);\n    }\n\n    this.buffer = extendedArray;\n    this.capacity = newCapacity;\n  };\n\n  return BaseLineCollection;\n}(Element));\n\nvar lineVSSrc = shaderGraph.getVSCode([\n  panzoomVS\n]);\n\nvar lineFSSrc = \"\\nprecision highp float;\\nuniform vec4 uColor;\\n\\nvoid main() {\\n  gl_FragColor = uColor;\\n}\\n\";\n\n// TODO: this needs to be in a separate file, with proper resource management\nvar lineProgramCache = new Map(); // maps from GL context to program\n\nfunction makeLineProgram(gl, data, drawTriangles) {\n  var lineProgram = lineProgramCache.get(gl);\n  if (!lineProgram) {\n    var lineVSShader = glUtils.compile(gl, gl.VERTEX_SHADER, lineVSSrc);\n    var lineFSShader = glUtils.compile(gl, gl.FRAGMENT_SHADER, lineFSSrc);\n    lineProgram = glUtils.link(gl, lineVSShader, lineFSShader);\n    lineProgramCache.set(gl, lineProgram);\n  }\n\n  var locations = glUtils.getLocations(gl, lineProgram);\n\n  var lineBuffer = gl.createBuffer();\n  var bpe = data.BYTES_PER_ELEMENT;\n  var drawType = drawTriangles ? gl.TRIANGLES : gl.LINES;\n  gl.bindBuffer(gl.ARRAY_BUFFER, lineBuffer);\n  gl.bufferData(gl.ARRAY_BUFFER, data.byteLength, gl.STATIC_DRAW);\n  gl.bufferSubData(gl.ARRAY_BUFFER, 0, data);\n\n  var api = {\n    draw: draw,\n    dispose: dispose\n  };\n\n  return api;\n\n  function dispose() {\n    gl.deleteBuffer(lineBuffer);\n    gl.deleteProgram(lineProgram);\n    lineProgramCache.delete(gl);\n  }\n\n  function draw(transform, color, screen) {\n    if (data.length === 0) { return; }\n\n    gl.useProgram(lineProgram);\n\n    gl.uniformMatrix4fv(locations.uniforms.uTransform, false, transform.getArray());\n    gl.uniform2f(locations.uniforms.uScreenSize, screen.width, screen.height);\n    gl.uniform4f(locations.uniforms.uColor, color.r, color.g, color.b, color.a);\n\n    gl.bindBuffer(gl.ARRAY_BUFFER, lineBuffer);\n    gl.enableVertexAttribArray(locations.attributes.aPosition);\n    // TODO: Avoid buffering, if data hasn't changed?\n    gl.bufferData(gl.ARRAY_BUFFER, data, gl.STATIC_DRAW);\n    gl.vertexAttribPointer(locations.attributes.aPosition, 2, gl.FLOAT, false, bpe * 2, 0);\n\n    gl.drawArrays(drawType, 0, data.length / 2);\n  }\n}\n\nvar LineAccessor = function LineAccessor(buffer, offset) {\n  this.offset = offset;\n  this.buffer = buffer;\n  this.width = 1;\n};\n\nLineAccessor.prototype.setWidth = function setWidth (width) {\n  this.width = width;\n};\n\nLineAccessor.prototype.update = function update (from, to) {\n  var buffer = this.buffer;\n  var offset = this.offset;\n\n  var dx = to.x - from.x;\n  var dy = to.y - from.y;\n  if (dx === 0) { dx = 1e-4; }\n  if (dy === 0) { dy = 1e-4; }\n\n  var norm = Math.sqrt(dx * dx + dy * dy);\n  var u = dx/norm;\n  var v = dy/norm;\n\n  var width = this.width;\n  var uw = width * u;\n  var vw = width * v;\n  var x0 = from.x + vw;\n  var y0 = from.y - uw;\n  var x1 = to.x + vw;\n  var y1 = to.y - uw;\n  var x2 = from.x - vw;\n  var y2 = from.y + uw;\n  var x3 = to.x - vw;\n  var y3 = to.y + uw;\n\n  // Start\n  buffer[offset + 0] = x0;\n  buffer[offset + 1] = y0;\n\n  buffer[offset + 2] = x1;\n  buffer[offset + 3] = y1;\n\n  buffer[offset + 4] = x2;\n  buffer[offset + 5] = y2;\n\n  offset += 6;\n\n  // End\n  buffer[offset + 0] = x1;\n  buffer[offset + 1] = y1;\n\n  buffer[offset + 2] = x2;\n  buffer[offset + 3] = y2;\n\n  buffer[offset + 4] = x3;\n  buffer[offset + 5] = y3;\n  // buffer[offset + 0] = from.x\n  // buffer[offset + 1] = from.y\n\n  // buffer[offset + 2] = to.x\n  // buffer[offset + 3] = to.y\n};\n\n/**\n * Lines have varying thickness. That comes at extra price: Each line\n * requires additional space in buffer, as it is rendered as triangles\n */\nvar LineCollection = (function (BaseLineCollection$$1) {\n  function LineCollection(capacity) {\n    BaseLineCollection$$1.call(this, capacity, 12); // items per thick line\n    this.type = 'LineCollection';\n  }\n\n  if ( BaseLineCollection$$1 ) LineCollection.__proto__ = BaseLineCollection$$1;\n  LineCollection.prototype = Object.create( BaseLineCollection$$1 && BaseLineCollection$$1.prototype );\n  LineCollection.prototype.constructor = LineCollection;\n\n  LineCollection.prototype._makeProgram = function _makeProgram (gl) {\n    return makeLineProgram(gl, this.buffer, /* drawTriangles = */ true);\n  };\n\n  LineCollection.prototype._addInternal = function _addInternal (line, offset) {\n    // TODO: width\n    var lineUI = new LineAccessor(this.buffer, offset);\n    lineUI.update(line.from, line.to);\n    return lineUI;\n  };\n\n  return LineCollection;\n}(BaseLineCollection));\n\n/**\n * Wire accessor provides access to the buffer that stores wires.\n * \n * Wires are \"lines\" with 1.0 width.\n */\nvar WireAccessor = function WireAccessor(buffer, offset) {\n  this.offset = offset;\n  this.buffer = buffer;\n};\n\nWireAccessor.prototype.update = function update (from, to) {\n  var buffer = this.buffer;\n  var offset = this.offset;\n\n  buffer[offset + 0] = from.x;\n  buffer[offset + 1] = from.y;\n\n  buffer[offset + 2] = to.x;\n  buffer[offset + 3] = to.y;\n};\n\n/**\n * Unlike lines, wires do not have width, and are always 1px wide, regardless\n * of resolution.\n */\nvar WireCollection = (function (BaseLineCollection$$1) {\n  function WireCollection(capacity) {\n    BaseLineCollection$$1.call(this, capacity, 4); // items per wire\n\n    this.type = 'WireCollection';\n  }\n\n  if ( BaseLineCollection$$1 ) WireCollection.__proto__ = BaseLineCollection$$1;\n  WireCollection.prototype = Object.create( BaseLineCollection$$1 && BaseLineCollection$$1.prototype );\n  WireCollection.prototype.constructor = WireCollection;\n\n  WireCollection.prototype._makeProgram = function _makeProgram (gl) {\n    return makeLineProgram(gl, this.buffer, /* drawTriangles = */ false);\n  };\n\n  WireCollection.prototype._addInternal = function _addInternal (line, offset) {\n    var lineUI = new WireAccessor(this.buffer, offset);\n    lineUI.update(line.from, line.to);\n    return lineUI;\n  };\n\n  return WireCollection;\n}(BaseLineCollection));\n\nfunction isWebGLEnabled$1(canvas) {\n  try {\n    if (!window.WebGLRenderingContext) { return false; }\n    if (!canvas) { canvas = document.createElement('canvas'); }\n    return !!(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));\n  } catch (e) {\n    return false;\n  }\n}\n\nexport { makeScene$1 as scene, PointCollection, Point, LineCollection, WireCollection, Element, isWebGLEnabled$1 as isWebGLEnabled, glUtils as utils };\n//# sourceMappingURL=wgl.module.js.map\n"],"sourceRoot":""}